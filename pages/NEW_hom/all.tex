\documentclass[12pt]{article}


\usepackage{showkeys}

\usepackage{hyperref}
\usepackage{amsmath, amssymb, amsthm, bm}
\usepackage[sort&compress,numbers]{natbib}
\usepackage{doi}
\usepackage[margin=0.8in]{geometry}
\usepackage[all]{xy}

%\textheight23cm \topmargin-20mm  
%\textwidth175mm  
%\oddsidemargin=0mm
%\evensidemargin=0mm
%

\usepackage{amsmath, amssymb, amsthm, mathtools}

\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\newtheorem{coro}{Corollary}
\newtheorem{prop}{Proposition}


\theoremstyle{definition}
\newtheorem{defi}{Definition}


\theoremstyle{remark}
\newtheorem{remark}{Remark}
\newtheorem{exm}{Example}

\def\aff{\operatorname{Aff}}
\def\lin{\operatorname{Lin}}
\def\Span{\operatorname{Span}}
\def\type{\mathrm {setting}}
\def\ii{\bm{\emptyset}}
\def\tt{\bm{0}}
\def\Ce{\mathcal C}
\def\Ae{\mathcal A}
\def\Ne{\mathcal N}
\def\Te{\mathcal T}
\def\Fe{\mathcal F}
\def\Pe{\mathcal P}
\def \Tr{\mathrm{Tr}\,}
\def\Se {\mathcal S}
\def\supp{\mathrm{supp}}
\def\<{\langle\,}
\def\>{\,\rangle}
\def \BS{\mathrm{BS}}
\def \Afh{\mathrm{AfH}}
\def \Af{\mathrm{Af}}
\def \FV{\mathrm{FinVect}}
\def\bV{\mathbf V}
\def\bW{\mathbf W}
\def\bE{ E}
\def\bI{I}

\def\Cl{\mathrm{Clas}}
\def\Quant{\mathrm{Quant}}
\def\bX{ X}
\def\bQ{\mathbf Q}
\def\bY{ Y}
\def\bZ{Z}

\title{On the structure of  higher order quantum maps}
\author{Anna Jen\v cov\'a}

\begin{document}

\maketitle

\section{Preliminaries}

\subsection{The category $\FV$} \label{sec:fv}

Let  $\FV$ be the category of finite dimensional real vector spaces with linear maps. 
We will denote the usual tensor product by $\otimes$, then  $(\FV,\otimes, I=\mathbb R)$
is a symmetric monoidal category, with the associators, unitors and symmetries given by
the obvious isomorphisms 
\begin{align*}
\alpha_{U,V,W}&:(U\otimes V)\otimes W\simeq U\otimes (V\otimes W), \\
\lambda_V&: I\otimes
V\simeq
V, \qquad \rho_V: V\otimes I\simeq V,\\
\sigma_{U,V}&: U\otimes V\simeq V\otimes U.
\end{align*}




Let  $(-)^*: V\mapsto V^*$ be the usual vector space dual, with duality denoted by
$\<\cdot,\cdot\>: V^*\times V\to \mathbb R$. We will use the canonical identification
$V^{**}=V$ and $(V_1\otimes V_2)^*=V_1^*\otimes V_2^*$. With this duality, $\FV$ is
compact closed. This means that for each object $V$, there are maps $\eta_V: I\to V^*\otimes
V$ (the ''cup'') and $\epsilon_V: V\otimes V^*\to I$ (the ''cap'') such that the following snake
identities hold:
\begin{equation}\label{eq:snake}
(\epsilon_V\otimes V)\circ (V\otimes \eta_V)=V,\qquad (V^*\otimes \epsilon_V)\circ
(\eta_V\otimes V^*)=V^*,
\end{equation}
here we denote the identity map on the object $V$ by $V$. Indeed, $\eta_V$ can be
identified with an element $\eta_V(1)\in V^*\otimes V$ and   $\epsilon_V\in (V\otimes
V^*)^*=V^*\otimes V$ is again an element of the same space.  Choose a basis
$\{e_i\}$ of $V$, let $\{e_i^*\}$ be the dual basis of $V^*$, that is,
$\<e_i^*,e_j\>=\delta_{i,j}$. Let us then define
\[
\eta_V(1)=\epsilon_V:=\sum_i e_i^*\otimes e_i.
\]
It is easy to see that this definition does not depend on the choice of the basis, indeed,
$\epsilon_V$ is the linear functional on $V\otimes V^*$ defined by
\[
\<\epsilon_V, x\otimes x^*\>=\<x^*,x\>,\qquad x\in V, \ x^*\in V^*.
\]
It is also easily checked that the snake identities \eqref{eq:snake} hold.

For two objects $V$ and $W$ in $\FV$, we will denote the set of all morphisms (i.e. linear
maps) $V\to
W$ $L(V,W)$  by $\FV(V,W)$. Then $\FV(V,W)$ is itself a real linear space and  we have the well-known identification 
$\FV(V,W)\simeq V^*\otimes W$. This can be given as follows: for each $f\in FV(V,W)$, we have 
$C_f:=(V^*\otimes f)(\epsilon_V)=\sum_i e_i^*\otimes f(e_i)\in V^*\otimes W$. Conversely,
since $\{e_i^*\}$ is a basis of $V^*$, 
any element $w\in V^*\otimes W$ can be uniquely written as $w=\sum_i e_i^*\otimes w_i$ for
$w_i\in W$, and since $\{e_i\}$ is a basis of $V$, the assignment $f(e_i):=w_i$ determines a
unique map $f:V\to W$. The relations between $f\in \FV(V,W)$ and $C_f\in V^*\otimes W$ can
be also written as
\[
\<C_f,x\otimes y^*\>=\<\epsilon_V,x\otimes f^*(y^*)\>=\<f^*(y^*),x\>=\<y^*,f(x)\>,\qquad x\in
V,\ y^*\in W^*,
\]
here $f^*:W^*\to V^*$ is the adjoint of $f$.
Note that by compactness, the internal hom in $\FV$ satisfies $[V,W]\simeq V^*\otimes W$,
so that  in the case of $\FV$, the object $[V,W]$ can be identified with the space of linear
maps $\FV(V,W)$. 


\begin{exm}\label{exm:classical} Let $V=\mathbb R^N$. In this case, we fix the canonical basis $\{|i\>,\
i=1,\dots,N\}$. We will identify $(\mathbb R^N)^*=\mathbb R^N$, with duality
$\<x,y\>=\sum_i x_iy_i$, in particular, we identify $I=I^*$. We then have
$\epsilon_V=\sum_i |i\>\otimes |i\>$ and if $f:\mathbb R^N\to \mathbb R^M$ is given by the
matrix $A$ in the two canonical bases, then  $C_f=\sum_i |i\>\otimes A|i\>$ is the
vectorization of $A$.

\end{exm}


\begin{exm}\label{exm:quantum} Let $V=M_n^h$ be the space of $n\times n$ complex hermitian matrices. We again
identify $(M_n^h)^*=M_n^h$, with duality $\<A,B\>=\Tr A^TB$, where $A^T$ is the usual
transpose of the matrix $A$. Let us choose the basis in $M_n^h$, given as
\[
\left\{|j\>\<k|+|k\>\<j|,\ j\le k,\ i\biggl(|j\>\<k|-|k\>\<j|\biggr),\ j<k\right\}.
\]
Then one can check that
\[
\left\{\frac12\biggl(|j\>\<k|+|k\>\<j|\biggl),\ j\le k,\
\frac{i}{2}\biggl(|k\>\<j|-|j\>\<k|\biggr),\ j<k\right\}
\]
is the dual basis and we have
\[
\epsilon_V=\sum_{j,k} |j\>\<k|\otimes |j\>\<k|.
\]
For any $f:M_n^h\to M_m^h$, 
\[
C_f=\sum_{j,k} |j\>\<k|\otimes f(|j\>\<k|)
\]
is the Choi matrix of $f$.

\end{exm}


\subsection{Boolean functions}


We will work with certain boolean functions, which are defined as  functions from binary
strings $\{0,1\}^*$ to $\{0,1\}$. We now list some basic notations used below.

For $s\in \{0,1\}$, we denote $\bar s:=1-s$.
For binary strings of fixed length $n$, that is, elements of
$\{0,1\}^n$, we will denote by $0_n$ or just $0$ the string $00\dots0$ and 
\[
e^i=\delta_{i,1}\dots\delta_{i,n}.
\]
For $m,n\in \mathbb N$, the concatenation of 
strings $s\in \{0,1\}^m$ and $t\in \{0,1\}^n$ will be denoted by $st$, that is,
\[
st=s_1\dots s_mt_1\dots t_n\in \{0,1\}^{m+n}.
\]
For a string $x\in \{0,1\}^n$ and any set of indices $\{i_1,\dots,i_k\}\subseteq [n]$, we
will denote by $x^{i_1\dots i_k}$ the string in $\{0,1\}^{n-k}$ obtained from $x$ by removing
$x_{i_1},\dots, x_{i_k}$. For any permutation $\sigma\in S_n$, we will denote by the same symbol the obvious action
on $\{0,1\}^n$, that is
\[
\sigma(s_1\dots s_n)=s_{\sigma(1)}\dots s_{\sigma(n)}.
\]


Let us introduce the subset 
\[
\Fe_n:=\{f:\{0,1\}^n\to \{0,1\},\ f(0)=1\}.
\]
With the poitwise ordering, $\Fe_n$ is  a (finite) distributive lattice, with top element
 the constant 1 function and the bottom element $p_n:=\chi_{0}$, the characteristic
 function of the zero string.  We may also
define complementation  in $\Fe_n$ as
\[
f^*:=1-f+p_n.
\]
It can be easily checked that with these structures $\Fe_n$ is a boolean algebra.

We now introduce some more operations in $\Fe_n$. For $f\in \Fe_n$ and any permutation $\sigma\in S_n$, we see that $f\circ \sigma\in \Fe_n$.
For $f\in \Fe_{m}$ and $g\in \Fe_n$, we define
the function $f\otimes g\in \Fe_{m+n}$ as
\[
(f\otimes g)(st)=f(s)g(t). 
\]
As it is, this tensor product is not symmetric, but there is a permutation $\sigma\in S_{m+n}$ such that 
$(g\otimes f)=(f\otimes g)\circ \sigma$ for any $f\in \Fe_m$ and $g\in \Fe_n$.

\begin{lemma}\label{lemma:fproduct} For $f\in \Fe_m$, $g\in \Fe_n$, we have
\[
f\otimes g\le (f^*\otimes g^*)^*.
\]
Equality holds if and only if $f$ and $g$ are either both the  top or both the bottom elements in
$\Fe_m$ resp. $\Fe_n$.
\end{lemma}

\begin{proof} The inequality is easily  checked, since $(f\otimes g)(st)$ can be 1 only if
$f(s)=g(t)=1$. If both $s$ and $t$ are the zero strings, then $st=0_{m+n}$ and both sides
are equal to 1. Otherwise, the condition $f(s)=g(t)=1$ implies that $(f^*\otimes
g^*)(st)=0$, which implies that the right hand side must be 1. If $f$ and $g$ are both
constant 1, then $(1\otimes 1)^*=1^*=p_{n+m}=1^*\otimes 1^*$, in the case when both $f$
and $g$ are the minimal elements equality  follows by
duality. Finally, asume the equality holds and that $f\ne 1$, so that there is some $s$ such that 
$f(s)=0$. But then $s\ne 0$ and for any $t$,
\[
0=(f\otimes g)(st)=(f^*\otimes g^*)^*(st)=1-f^*(s)g^*(t)+p_{m+n}(st)=1-g^*(t),
\]
which implies that $g(t)=0$ for all $t\ne0$, that is, $g=p_n$. By the same argument,
$f=p_m$ if $g\ne 1$, which implies that either $f=1$ and $g=1$, or $f=p_m$ and $g=p_n$.



\end{proof}



We now show an important example. 


\begin{exm}\label{ex:ps} Let $S\subseteq [n]$ be any subset. We will denote
\[
p_S(s):=\prod_{i\in S}\bar s_i.
\]
It is clear that $p_S\in \Fe_n$, $p_{\emptyset}=1$, $p_{[n]}=\chi_0=p_n$. The following
properies are also easy
to see for $S,T\subseteq [n]$:
\begin{enumerate}
\item[(i)] if $S\subseteq T$, then $p_T\le p_S$,
\item[(ii)]  $p_S\wedge p_T=p_Sp_T=p_{S\cup T}$,
\item[(iii)]  $p_S\vee p_T=p_S+p_T-p_{S\cup T}$.
\item[(iv)] let $S\subseteq [m]$ and $T\subseteq [n]$, then 
\[
p_S\otimes p_T=p_{S\cup (m+T)}.
\]
\end{enumerate}


\end{exm}




We will use the above functions to introduce  a convenient  parametrization to $\Fe_n$.  
For this, we first include $\Fe_n$ into a larger set
\[
\Fe_n\subseteq \{f:\{0,1\}^n\to \mathbb R\}=:\mathcal V,
\]
which is a $2^n$-dimensional real vector space. It becomes a Hilbert space with respect to
the inner product
\[
\<f,g\>=\sum_{s\in \{0,1\}^n} f(s)g(s). 
\]

\begin{lemma}\label{lemma:Vbasis} The set $\{p_S,\ S\subseteq [n]\}$ is a basis of
$\mathcal V$.
Any $f\in \mathcal V$ can be uniquely written as
\[
f=\sum_{S\subseteq [n]} \hat f_Sp_S,
\]
where the coefficients $\hat f_S\in \mathbb R$ are obtained as
\[
\hat f_S=\sum_{\substack{x\in \{0,1\}^n\\ x_i=1, \forall  i\in S^c}} (-1)^{\sum_{i\in
S}x_i}f(x).
\]
\end{lemma}



\begin{proof} For $T\subseteq [n]$, let us define the function $p_T^\perp$ as
\[
p_T^\perp(x):= (-1)^{\sum_{i\in T}x_i}\prod_{i\in T^c}x_i. 
\]
We prove that for $S,T\subseteq [n]$,
\[
\<p_S,p^\perp_T\>=\delta_{S,T},
\]
which shows that $\{p_S,\ S\subseteq [n]\}$ is a basis and 
$\{p_T^\perp, \ T\subseteq [n]\}$  is the dual basis. We compute
\[
\<p_S,p^\perp_T\>=\sum_x p_S(x)p^\perp_T(x)=\sum_x (-1)^{\sum_{i\in T} x_i}\prod_{i\in S}
\bar x_i\prod_{j\in T^c}x_j.
\]
This expression can be nonzero only if $S\cap T^c=\emptyset$, that is, $S\subseteq T$. In
this case, the last sum  is equal to
\[
\sum_{\substack{x\in \{0,1\}^n\\ x_i=0,\forall i\in S\\x_i=1,\forall i\in T^c}}
(-1)^{\sum_{j\in T\setminus S}x_j}=\begin{dcases} 0 & \text{if } S\subsetneq T\\
  1 &\text{if } S=T
  \end{dcases}
\]
It is now clear that the coefficients
\[
\hat f_S=\<f,p^\perp_S\>
\]
have the given form.


\end{proof}

\begin{remark} This can be also obtained using M\"obius inversion formula, see [Stanley,
Sec. 3.7].

\end{remark}


Let $\mathcal L_n$ be the lattice of subsets in
$[n]$. We can  visualise $\mathcal L_n$ as a hypercube, and the coefficients $\hat f_S$ of  $f$ as labels for its vertices.
Let $s\in\{0,1\}^n$ be a string  such that $s_j=1$ if and only if $j\in T$. Then
$p_S(s)=1$ if and only if $T\cap S=\emptyset$. 
The fact that the function $f$ takes  values in $\{0,1\}$ means that we must have 
\[
f(s)=\sum_{\substack{S\subseteq [n]\\ S\cap T=\emptyset}} \hat f_S\in \{0,1\}.
\]
It follows that  the sum of labels $\hat f_S$ over any face of the hypercube $\mathcal L_n$ containing the vertex $\emptyset$ must
be 0 or 1. In particular, $\hat f_\emptyset=f(11\dots 1)\in \{0,1\}$. The fact that $f\in \Fe_n$ means that in addition,
\[
f(0)=\sum_{S\subseteq [n]}\hat f_S=1.
\]





\section{The category of affine subspaces}


\subsection{The category $\Af$}

We now introduce the category $\Af$, whose objects  are of the form $X=(V_X,A_X)$, where
$V_X$ is an object in $\FV$  and $A_X\subseteq V_X$ a proper affine subspace, which means
that $0\notin A_X\ne \emptyset$. Morphisms $X\xrightarrow{f} Y$ in $\Af$ are linear maps $f:V_X\to V_Y$  such that
$f(A_X)\subseteq A_Y$. For any object $X$, we put
\begin{align*}
L_X=\lin(A_X):=\{a_1-a_2,\ a_1,a_2\in A_X\}=\{a-a_X,\ a\in A_X\}, \qquad S_X:=\Span(A_X).
\end{align*}
Here $a_X$ is any element in $A_X$ and $L_X$ does not depend on this choice.
Then $L_X$ and $S_X$ are linear subspaces such that $d_X:=\dim(L_X)=\dim(S_X)-1$. We will
also denote $D_X=\dim(V_X)$. For
any element $a_X\in A_X$, the affine subspace is determined as
\[
A_X=a_X+L_X.
\]

Let us now define the duality of affine subspaces as follows. Let $V$ be an object in
$\FV$ and let $C\subseteq  V$ be any subset. Let
\[
\tilde C:=\{v^*\in V^*, \ \<v^*,c\>=1\}.
\]
The following lemma collects some properties that are easily proven.

\begin{lemma}\label{lemma:dual}
\begin{enumerate}
\item[(i)] $\tilde C$ is an affine subspace.
\item[(ii)] $0\in \tilde C$ if and only if $C= \emptyset$ and   $\tilde C=\emptyset$ if and only if $0\in \aff(C)$.
\item[(iii)] Let  $0\notin \aff(C)$, then $\aff(C)=\tilde{\tilde C}$ and we have
\begin{align*}
\lin(C)&=\lin(\tilde{\tilde C})=\tilde
C^\perp=\Span(\tilde C)^\perp,&  \lin(\tilde C)&=C^\perp=\Span(C)^\perp \\
\Span(C)&=C^{\perp\perp} =\lin(\tilde C)^\perp,&  \Span(\tilde C)&=\lin(C)^\perp.
\end{align*}

\end{enumerate}


\end{lemma}



For any  $\tilde a_X\in \tilde A_X$, the subspace $A_X$ is determined as
\[
A_X=S_X\cap\{\tilde a_X\}^\sim.
\]
The relation between the subspaces $L_X$ and $S_X$ is given as
\[
S_X=L_X\oplus \mathbb R a_X,\qquad L_X=S_X\cap \{\tilde a_X\}^\perp.
\]
By Lemma \ref{lemma:dual} above,  $\tilde A_X$ is a proper affine subspace in $V_X^*$, so that
$X^*:=(V_X^*,\tilde A_X)$ is an object in $\Af$. We have $X^{**}=X$ and the corresponding subspaces
are related as
\begin{equation}\label{eq:duality}
L_{X^*}=S_X^\perp,\qquad S_{X^*}=L_X^\perp.
\end{equation}
Note also that for $X\xrightarrow{f} Y$, the adjoint map satisfies $f^*(\tilde
A_Y)\subseteq \tilde A_X$, so that $Y^*\xrightarrow{f^*} X^*$ and the duality $(-)^*$ is a
full and faithful functor 
$\Af^{op}\to \Af$.

We will next introduce a monoidal structure $\otimes$ as follows. For two objects $X$ and
$Y$, we put  $V_{X\otimes Y}=V_X\otimes V_Y$ and construct the affine subspace
$A_{X\otimes Y}$ as the affine span of 
\[
A_X\otimes A_Y=\{a\otimes b,\ a\in A_X,\ b\in A_Y\}.
\]
Fix any $\tilde a_X\in \tilde A_X$ and $\tilde a_Y\in \tilde A_Y$. 
Since $A_X\otimes A_Y\subseteq \{\tilde a_X\otimes \tilde a_Y\}^\sim$, the affine span of
$A_X\otimes A_Y$ is a proper affine subspace and we have by Lemma \ref{lemma:dual}
\[
A_{X\otimes Y}:=\aff(A_X\otimes A_Y)=\{A_X\otimes A_Y\}^{\approx}.
\]
\begin{lemma}\label{lemma:tensor_spaces}
For any $a_X\in A_X$, $a_Y\in A_Y$, we  have
\begin{align}
L_{X\otimes Y}&=\lin(A_X\otimes A_Y)=\Span(\{x\otimes y-a_X\otimes a_Y,\ x\in A_X,\ y\in
A_Y\})\label{eq:lxy1}\\
&= (a_X\otimes L_Y)+ (L_X\otimes a_Y)+ (L_X\otimes L_Y)\label{eq:lxy}
%\\ &= S_X\otimes L_Y+L_X\otimes a_Y=a_X\otimes L_Y+L_X\otimes S_Y
\end{align}
(here $+$ denotes the direct sum of subspaces). We also have
\[
S_{X\otimes Y}=S_X\otimes S_Y.
\]
\end{lemma}

\begin{proof} The equality \eqref{eq:lxy1} follows from Lemma \ref{lemma:dual}. For any $x\in A_X$, $y\in A_Y$
 we have
\[
x\otimes y-a_X\otimes a_Y=a_X\otimes (y-a_Y)+(x-a_X)\otimes a_Y+(x-a_X)\otimes (y-a_Y),
\]
so that $L_{X\otimes Y}=\lin(A_X\otimes A_Y)$ is contained in the subspace on the RHS of \eqref{eq:lxy}.
Let $d$ be the dimension of this subspace, then clearly
\[
d_{X\otimes Y}\le d\le d_X+d_Y+d_Xd_Y.
\]
On the other hand, any element of $S_X$ has the form $tx$ for some $t\in \mathbb R$ and
$x\in A_X$, so that it is easily seen that $S_X\otimes S_Y=S_{X\otimes Y}$. 
Hence 
\begin{align*}
d_{X\otimes Y}&=\dim(L_{X\otimes Y})=\dim(S_{X\otimes
Y})-1=\dim(S_X)\dim(S_Y)-1=(d_X+1)(d_Y+1)-1\\
&=d_X+d_Y+d_Xd_Y.
\end{align*}
This completes the proof.

\end{proof}




\begin{lemma}\label{lemma:monoidal} Let $I=(\mathbb R,\{1\})$. Then 
$(\Af,\otimes, I)$ is a symmetric monoidal category.
\end{lemma}

\begin{proof} Note that this structure is inherited from the symmetric monoidal structure
in $\FV$. To show that $\otimes$ is a functor, we have to check that for $X_1\xrightarrow{f} Y_1$ and $X_2\xrightarrow{g} Y_2$ in
$\Af$, we have $X_1\otimes Y_1\xrightarrow{f\otimes g} X_2\otimes Y_2$ which amounts to
showing that 
\[
(f\otimes g)(A_{X_1\otimes Y_1})\subseteq A_{X_2\otimes Y_2}.
\]
Let $x\in A_{X_1}$, $y\in A_{Y_1}$, then $f(x)\otimes g(y)\in A_{X_2}\otimes
A_{Y_2}\subseteq A_{X_2\otimes Y_2}$. Since  $A_{X_1\otimes Y_1}$ is the affine subspace
generated by $A(X_1)\otimes A(Y_1)$, the above inclusion follows by linearity of $f\otimes
g$. 

It only remains to prove that the associators, unitors and symmetries from
$\FV$ are morphisms in $\Af$. We will prove this for the associators $\alpha_{X,Y,Z}:V_X\otimes (V_Y\otimes V_Z)\to
(V_X\otimes V_Y)\otimes V_Z$, the other proofs are similar. We need to check that
$\alpha_{X,Y,Z}(A_{X\otimes(Y\otimes Z)})\subseteq A_{(X\otimes Y)\otimes Z}$. It is easily
checked that $A_{X\otimes(Y\otimes Z)}$ is the affine span of elements of the form
$x\otimes (y\otimes z)$, $x\in A_X$, $y\in A_Y$ and $z\in A_Z$, and we have
\[
\alpha_{X,Y,Z}(x\otimes (y\otimes z))=(x\otimes y)\otimes z\in A_{(X\otimes Y)\otimes Z}
\]
for all such elements. The desired inclusion follows by linearity.

\end{proof}


\begin{theorem} $(\Af,\otimes,I)$ is a *-autonomous category, with duality $(-)^*$, such
that $I^*=I$.

\end{theorem}


\begin{proof} By Lemma \ref{lemma:monoidal}, we have that $(\Af,\otimes I)$ is a symmetric
monoidal category. We have also seen that the duality $(-)^*$ is a full and faithful
contravariant functor. We only need to check the natural isomorphisms 
\[
\Af(X\otimes Y,Z^*)\simeq \Af(X,(Y\otimes Z)^*).
\]
Since $\FV$ is compact, we have the natural isomorphisms
\[
\FV(V_X\otimes V_Y,V^*_Z)\simeq \FV(V_X,V_Y^*\otimes V_Z^*),
\]
determined by the equalities
\[
\<f(x\otimes y),z\>=\<h(x),y\otimes z\>,\qquad x\in V_X,\ y\in V_Y,\ z\in V_Z,
\]
for $f\in \FV(V_X\otimes V_Y,V_Z^*)$ and $h\in \FV(V_Z,V_Y^*\otimes V_Z^*)$. Since
$A_{X\otimes Y}$ is an affine span of $A_X\otimes A_Y$, we see that
$f$ is in $\Af(X\otimes Y, Z^*)$ if and only if $f(x\otimes y)\in \tilde A_Z$ for all $x\in A_X$, $y\in
A_Y$, that is, 
\[
1=\<f(x\otimes y),z\>=\<h(x),y\otimes z\>\qquad \forall x\in A_X,\
\forall y\in A_Y,\ \forall z\in A_Z.
\]
But this is equivalent to
\[
h(x)\in (A_Y\otimes A_Z)^\sim=\tilde A_{Y\otimes Z},\qquad \forall x\in A_X,
\]
which means that $h\in \Af(X, (Y\otimes Z)^*)$.

\end{proof}
A *-autonomous category is compact closed if it satisfies $(X\otimes Y)^*=X^*\otimes
Y^*$. 
In general, $X\odot Y=(X^*\otimes Y^*)^*$ defines a dual symmetric monoidal
structure that is different from $\otimes$. 
We next show that $\Af$ is not compact.

\begin{prop}\label{prop:noncompact} For objects in $\Af$, we have $(X\otimes
Y)^*=X^*\otimes Y^*$ exactly in one of the following situations:
\begin{enumerate}
\item[(i)] $X\simeq I$ or $Y\simeq I$,
\item[(ii)] $d_X=d_Y=0$,
\item[(iii)] $d_{X^*}=d_{Y^*}=0$.
\end{enumerate}



\end{prop}

\begin{proof} It is easily seen by definition that $A_{X^*}\otimes A_{Y^*}=\tilde A_X\otimes \tilde
A_Y\subseteq \tilde A_{X\otimes Y}=A_{(X\otimes Y)^*}$. Hence the equality holds if and
only if $d_{X^*\otimes Y^*}=d_{(X\otimes Y)^*}$. From Lemma
\ref{lemma:tensor_spaces}, we see that
\[
d_{X^*\otimes Y^*}=d_{X^*}+d_{Y^*}+d_{X^*}d_{Y^*}.
\]
On the other hand, we have using \eqref{eq:duality} that $L_{(X\otimes Y)^*}=S_{X\otimes
Y}^\perp=(S_X\otimes S_Y)^\perp$, so that
\[
d_{(X\otimes Y)^*}=D_XD_Y-\dim(S_X)\dim(S_Y)=D_XD_Y-(d_X+1)(d_Y+1).
\]
Taking into account that by \eqref{eq:duality} we have $d_{X^*}=D_X-d_{X}-1$, similarly
for $d_{Y^*}$, we obtain

\[
d_{(X\otimes Y)^*}-d_{X^*\otimes Y^*}=d_Xd_{Y^*}+d_{X^*}d_Y.
\]
This is equal to 0 iff $d_Xd_{Y^*}=d_Yd_{X^*}=0$, which amounts to the conditions in the
lemma.

\end{proof}



In a *-autonomous category, the internal hom can be identified as $[X,Y]=(X\otimes
Y^*)^*$. The underlying vector space is $V_{[X,Y]}=(V_X\otimes V_Y^*)^*=V_X^*\otimes V_Y$
and we have seen in Section \ref{sec:fv} that we may identify this space with
$\FV(V_X,V_Y)$, by $f \leftrightarrow C_f$. This property is extended to $\Af$, in the
following sense.

\begin{prop}\label{prop:ihom_morphisms} For any objects $X,Y$ in $\Af$, the map $f\mapsto C_f$ is a bijection
of $\Af(X,Y)$ onto $A_{[X,Y]}$. 

\end{prop}

\begin{proof} Let $f\in \FV(V_X,V_Y)$. Since by definition $A_{[X,Y]}=\tilde A_{X\otimes Y^*}$ and $A_{X\otimes
Y^*}$ is an affine span of $A_X\otimes A_Y^*$, we see that $C_f\in A_{[X,Y]}$ if and only
if for all $x\in A_X$ and $y^*\in \tilde A_Y$, we have
\[
1=\<C_f, x\otimes y^*\>=\<y^*,f(x)\>.
\]
This latter statement is clearly equivalent to $f(A_X)\subseteq A_Y$, so that $f\in
\Af(X,Y)$. 
\end{proof}

In the next result, we restrict the objects to spaces of hermitian matrices, as in Example
\ref{exm:quantum} and morphisms to completely positive maps. We show that this restriction
amounts to taking an intersection of $A_{[X,Y]}$ with the cone of positive semidefinite
matrices. This, and subsequent examples,  shows that for characterization of sets  of quantum
objects such as states, channels, combs and transformations between them, it is enough to
work with the category $\Af$. 

An object $X$ of $\Af$ will be called quantum if $V_X=M_n^h$ for some $n$ and $A_X$ is an
affine subspace such that both $A_X$ and $\tilde A_X$ have nonempty intersection with the
interior of the positive cone 
$int(M_n^+)$ (recall that we identify $(M_n^h)^*=M_n^h$). 




\begin{prop}\label{prop:ihom_quantum} Let $X$, $Y$ be quantum objects in $\Af$. Then 
\begin{enumerate}
\item[(i)] $X^*$ and $X\otimes Y$ are quantum objects as well
\item[(ii)] Let $V_X=M_n^h$, $V_Y=M_m^h$. Then for any $f\in \FV(M_n^h,M_m^h)$, we have
$C_f\in A_{[X,Y]}\cap M_{mn}^+$ if and only if $f$ is completely positive and
\[
f(A_X\cap M_n^+)\subseteq A_Y\cap M_m^+.
\]
\end{enumerate}


\end{prop}

\begin{proof} The statement (i) is easily seen from  $A_X\otimes A_Y
\subseteq  A_{X\otimes Y}$ and $\tilde A_X\otimes \tilde A_Y\subseteq \tilde A_{X\otimes
Y}$, together with the fact that $int(M_n^+)\otimes int(M_m^+)\subseteq int(M_{mn}^+)$. 
To show (ii), let $C_f\in   A_{[X,Y]}\cap M_{mn}^+$. By the properties of the Choi
isomorphism $f$ is completely positive and by Proposition \ref{prop:ihom_morphisms},
$f(A_X)\subseteq A_Y$, this proves one implication. For the converse, note that we only
need to prove that under the given assumptions, $f(A_X)\subseteq A_Y$, for which it is enough
to show that $A_X\subseteq \aff(A_X\cap M_n^+)$. To see this, pick some  $a_X\in  A_X\cap
int(M_n^+)$. Any element in $A_X$ can be written in the form $a_X+v$ for some $v\in L_X$.
Since $a_X\in int(M_n^+)$, there is some $s>0$ such that $a_\pm:=a_X\pm sv\in M_n^+$, and
since $\pm sv\in L_X$, we see that $a_\pm \in A_X\cap M_n^+$. It is now easily checked
that
\[
a_X+v=\frac{1+s}{2s}a_++\frac{s-1}{2s}a_-\in \aff(A_X\cap M_n^+). 
\]


\end{proof}

We can define classical obejcts in $\Af$ in a similar way, replacing $M_n^h$ by $\mathbb
R^N$ and the positive cone by $\mathbb R_+^N$. A similar statement holds in this case,
with complete positivity replaced by positivity. We can similarly treat
classical-to-quantum and quantum-to-classical maps as morphisms between these types of
objects, satisfying appropriate positivity assumptions.

\begin{exm}\label{exm:quantum_maps} States, channels, combs, nonsignaling, etb, dual, process
matrices

\end{exm}

\begin{exm}\label{exm:qccq} POVMs, instruments, multimeters.


\end{exm}


\subsection{First order and higher order objects}


We say that an object $X$ in $\Af$ is first order if $d_X=D_X-1$, equivalently, $S_X=V_X$.
Another equivalent condition is $d_{X^*}=0$, which means that $A_X$ is determined by a
single element $\tilde a_X\in V_X^*$ as 
\[
A_X=\{\tilde a_X\}^\sim,\qquad \tilde A_X=\{\tilde a_X\}.
\]
In the case of first order quantum objects we additionally require that $\tilde a_X\in
int(M_n^+)$, similarly for classical first order objects.
Note that first order objects, resp. their duals, are exactly those satisfying
condition (iii), resp. condition (ii), in Proposition \ref{prop:noncompact}, in
particular, $(X\otimes Y)^*=X^*\otimes Y^*$ for first order objects $X$ and $Y$.

For a first order object $X=(V_X, \{\tilde a_X\}^\sim)$, let us pick an element $a_X\in
A_X$, then we have a direct sum decomposition
\[
V_X=L_{X,0}\oplus L_{X,1},
\]
where $L_{X,0}:= \mathbb R\{a_X\}$, $L_{X,1}:=\{\tilde a_X\}^\perp=L_X$.
We also define the {\em conjugate object} $\tilde X=(V_X^*,\{a_X\}^\sim)$, note that we always
have $\tilde a_X\in A_{\tilde X}$ and with the choice $a_{\tilde X}=\tilde a_X$, we have
$\tilde{\tilde X}=X$ and 
\begin{equation}\label{eq:complement}
L_{\tilde X,u}=L_{X,\bar u}^\perp,\qquad u\in \{0,1\}.
\end{equation}

These  definitions depend on the choice of $a_X$, but we will assume below that this
choice is fixed and that we choose $a_{\tilde X}=\tilde a_X$. For quantum objects we will
assume that $a_X\in int(M_n^+)$.


\begin{exm} Example: quantum states, multiple of identity...

\end{exm}


Higher order objects are those obtained from a finite set $\{X_1,\dots,X_n\}$ of first order objects by
taking tensor products and duals, and applying any permuations of the spaces. The above is indeed a set, so that all the objects are
different (though they may be isomorphic) and the ordering is not essential. We will also
assume that the tensor unit is not contained in this set. Of course, any first order
object is also higher order with $n=1$. Note that we cannot say that
such an object is automatically ''of order $n$'', as the following lemma shows. 

\begin{lemma}\label{lemma:1ordertensor} Let $X$, $Y$ be first order, then $X\otimes Y$ is
first order as well.

\end{lemma}

\begin{proof} We have
\[
S_{X\otimes Y}=S_X\otimes S_Y=V_X\otimes V_Y=V_{X\otimes Y}.
\]

\end{proof}




\begin{exm} (states quantum first order, channels,  supermaps - quantum higher order)

\end{exm}






\begin{exm} replacement $X^*\otimes Y$, quantum
\end{exm}

\subsection{Description of higher order objects}


We start by noticing that there are certain objects in $\Af$ that can be constructed from
a set of  first order objects and functions in $\Fe_n$. 

%{\color{blue} Define $\tilde X_i=(V_i^*, \{a_i\}^\sim)$!  }
Let $X_1,\dots,X_n$ be first order objects in $\Af$. Let $a_{X_i}\in A_{X_i}$ be fixed and
let $\tilde X_i$ be the conjugate first order objects. Let us denote $V_i=V_{X_i}$ and 
\[
L_{i,u}:= L_{X_i,u},\qquad  \tilde L_{i,u}:= L_{\tilde X_i,u} \qquad u\in \{0,1\},\ i\in [n].
\]
For $s\in \{0,1\}^n$, we define
\[
L_s:=L_{1,s_1}\otimes\dots \otimes L_{n,s_n}, \qquad \tilde L_s:=\tilde
L_{1,s_1}\otimes\dots \otimes \tilde L_{n,s_n},
\]
then we have the direct sum decompositions 
\[
V:=V_1\otimes \dots \otimes V_n=\bigoplus_{s\in \{0,1\}^n} L_s,\qquad V^*=V_1^*\otimes
\dots\otimes V_n^*=\bigoplus_{s\in \{0,1\}^n} \tilde L_s.
\]


\begin{lemma}\label{lemma:Lperp}   For any $s\in \{0,1\}^n$, we have 
\[
L_s^\perp=
\bigoplus_{t\in\{0,1\}^n} \bar{\chi}_s(t)\tilde L_t,\qquad \tilde L_s^\perp=
\bigoplus_{t\in\{0,1\}^n} \bar{\chi}_s(t)L_t.
\]
Here $\chi_s:\{0,1\}^n\to\{0,1\}$ is the characteristic function of $s$,
$\bar{\chi}_s=1-\chi_s$. 

\end{lemma}

\begin{proof} Using \eqref{eq:complement} and the direct sum decomposition of $V_i^*$, we get
\begin{align*}
\left(L_{1,s_{1}}\otimes \dots\otimes L_{n,s_{n}}\right)^\perp&= \bigvee_j\left(
V_{1}^*\otimes
\dots \otimes V_{j-1}^*\otimes \tilde L_{j,\bar s_{j}}\otimes V_{j+1}^*\otimes\dots \otimes
V_{n}^*\right)\\
&= \bigvee_j \left( \bigoplus_{\substack{t\in \{0,1\}^n\\ t_{j}\ne s_{j}}} \tilde
L_{1,t_{1}}\otimes\dots \otimes \tilde
L_{n,t_{n}}\right)\\
&= \bigoplus_{\substack{t\in \{0,1\}^n\\ t\ne s}} \left( \tilde L_{1,t_{1}}\otimes\dots \otimes \tilde
L_{n,t_{n}}\right).
\end{align*}
The proof of the other equality is the same.

\end{proof}



\begin{lemma}\label{lemma:Xf} Put $a:= a_1\otimes\dots \otimes  a_n$, $\tilde a:= \tilde
a_1\otimes\dots\otimes  \tilde a_n$.
For  $f\in \Fe_n$ define 
\[
S_f:=\bigoplus_{s\in \{0,1\}^n} f(s)L_s,\qquad A_f=A_f(X_1,\dots,X_n):=S_f\cap \{\tilde a\}^\sim.
\]
Then $A_f$ is a proper affine subspace in $V$ containing $a$. Moreover,
\[
L_{A_f}=\bigoplus_{s\in\{0,1\}^n\setminus\{0\}} f(s)L_s,\qquad S_{A_f}=S_f
\]
and the dual affine subspace satisfies  
\[
\tilde A_f(X_1,\dots,X_n)=A_{f^*}(\tilde X_1,\dots, \tilde X_n)=\bigoplus_{s\in \{0,1\}^n}
f^*(s)\tilde L_s\cap\{a\}^\sim .
\]
 

%determined by 
%\[
%\tilde A_f=S_{\tilde A_f}\cap \{a\}^\sim,\qquad S_{\tilde A_f}= \bigoplus_{s\in \{0,1\}^n} f^*(s)\tilde L_s.
%\]

\end{lemma}

\begin{proof} It is clear from definition that $A_f$ is an affine subspace. Since
$f(0)=1$, the space $S_f$ always contains the subspace $L_0=L_{1,0}\otimes\dots\otimes
l_{n,0}=\mathbb R\{a\}$ and it is clear that $L_s\subseteq \{\tilde a\}^\perp$ for any
$s\ne 0$. It follows that $a\in A_f$, so that $A_f\ne \emptyset$, and since $A_f\subseteq
\{\tilde a\}^\sim$, we see that  $A_f$ is proper and $\tilde
a\in \tilde A_f$.  The expressions for $L_{A_f}$ and $S_{A_f}$ are immediate from the definition and
$L_{A_f}=S_{A_f}\cap\{\tilde a\}^\sim$. To obtain the dual affine subspace, we compute
using Lemma \ref{lemma:Lperp} and the fact that the subspaces form an independent
decomposition,
\begin{align*}
S_{\tilde A_f}&=L_{A_f}^\perp=\left(\bigoplus_{s\in\{0,1\}^n\setminus\{0\}}
f(s)L_s\right)^\perp=
\bigwedge_{\substack{s\in\{0,1\}^n\\ s\ne 0, f(s)=1}}L_s^\perp=
\bigwedge_{\substack{s\in\{0,1\}^n\\ s\ne 0,
f(s)=1}}\left(\bigoplus_{t\in\{0,1\}^n} \bar{\chi}_s(t)\tilde L_t\right)\\
&=\bigoplus_{t\in\{0,1\}^n} \left(\bigwedge_{\substack{s\in \{0,1\}^n\\ s\ne 0, f(s)=1}}
\bar{\chi}_s(t)\tilde L_t\right)=\bigoplus_{t\in \{0,1\}^n} f^*(t) \tilde L_t.
\end{align*}
To see the last equality, note that
\[
\bigwedge_{\substack{s\in \{0,1\}^n\\ s\ne 0, f(s)=1}}
\bar{\chi}_s(t)=\begin{dcases} 1 & \text{if } t=0\\ 1-f(t) & \text{if } t\ne 0
\end{dcases} \ = f^*(t).
\]


\end{proof}

Since $L_s$, $s\in \{0,1\}$ is an independent decomposition, the map $f\mapsto S_f$, and
hence also $f\mapsto A_f$, is injective. This map  has the following further properties, which are easily checked:
\begin{enumerate}
\item[(i)] For the bottom and top elements in $\Fe_n$ we have
\[
A_{p_n}=\{a\},\qquad A_{1_n}=\{\tilde a\}^\sim,
\]
\item[(ii)] We have $f\le g$ if and only if $A_f\subseteq A_g$,
\item[(iii)] $A_{f\wedge g}=A_f\cap A_g$,
\item[(iv)] $A_{f\vee g}= A_f\vee A_g:=\aff(A_f\cup A_g)$.
\end{enumerate}
It follows that the set $\{A_f,\ f\in
\Fe_n\}$ is a distributive lattice, with respect to the lattice operations $\cap$ and
$\vee$.

Since all the affince subspaces  $A_f\subseteq V$ are proper, there are objects $X_f:=(V,A_f)$ in $\Af$. The
above relations can be rephrased as follows:
\begin{enumerate}
\item[(i)] $X_{1_n}=(V,\{\tilde a\}^\sim)$ is a first order object,
$X_{p_n}=(V^*,\{a\}^\sim)^\sim$ is a dual first order object.
\item[(ii)] We have $f\le g$ if and only if $id_V$ is a morphism $X_f\to X_g$ in $\Af$,
\item[(iii)] Let $f,g\le h$. The following is a pullback diagram:
\[
%\xymatrixcolsep{5pc}\xymatrixrowsep{3pc}
\xymatrix{
X_{f\wedge g}\ar[r]^{id_V}
\ar[d]_{id_V} & X_f\ar[d]^{id_V} \\
X_{g} \ar[r]_{id_V}& X_{h} 
}
\]

\item[(iv)] Let $h\le f,g$. The following is a pushout diagram:
\[
\xymatrix{
X_{h}\ar[r]^{id_V}
\ar[d]_{id_V} & X_f\ar[d]^{id_V} \\
X_{g} \ar[r]_{id_V}& X_{f\vee g} 
}
\]


\end{enumerate}
In particular, it follows that $\{X_f,\ f\in \Fe_n\}$, is a distributive lattice, with
pullbacks and pushouts as lattice operations. Furthermore, using the conjugate objects, we
may construct 
\[
\tilde X_f:=(V^*, A_f(\tilde X_1,\dots,\tilde X_n))
\]
and we see from Lemma
\ref{lemma:Xf} that 
\begin{equation}\label{eq:dualityXf}
X_f^*=\tilde X_{f^*},\qquad f\in \Fe_n.
\end{equation}



We next observe that the higher order objects are of the form $X_f$, for some choice of the
first order objects $X_1,\dots, X_n$ and a function $f$ that belongs to a special subclass of $\Fe_n$.  
So assume that  $Y$ is a higher order object constructed from a set of distinct first
order objects $Y_1,\dots, Y_n$, $Y_i=(V_{Y_i},\{\tilde a_{Y_i}\}^\sim)$, we will write
$Y\sim\{Y_1,\dots,Y_n\}$ in this case. Let us fix elements $a_{Y_i}\in A_{Y_i}$ and construct the objects $\tilde Y_i$. 
 
 By compactness of $\FV$, we may assume (relabeling the objects if necessary) that the vector space of $Y$ has the form
\[
V_Y=V:=V_{1}\otimes \dots\otimes V_{n},
\]
where  $V_i$ is either $V_{Y_i}$ or $V_{Y_i}^*$, according to whether $Y_i$ was subjected
to taking duals an even or odd number of times. The indices such that the first
case is true will be called the outputs and the subset of outputs in $[n]$ will be denoted
by $O$, or $O_Y$, when we need to specify the object. The set $I=I_Y:=[n]\setminus O_Y$ is
the set of inputs. The reason for this terminology will become clear later. 

\begin{prop}\label{prop:boolean} For $i\in [n]$, let 
$X_i=Y_i$ if $i\in O_Y$ and $X_i=\tilde Y_i$ for $i\in I_Y$. 
There is a unique function $f\in \Fe_n$ such that 
\[
Y= X_f=(V, A_f(X_1,\dots,X_n)).
\]

\end{prop}

\begin{proof} Since the map $f\mapsto X_f$ is injective, uniqueness is clear.  To show existence of this
function, we will proceed by induction on $n$. For $n=1$, the assertion is easily seen
to be true, since in this case, we we have either $Y=Y_1$ or $Y=Y_1^*$. In the first case, $O=[1]$,
$X_1=Y_1$ and 
\[
S_Y=V_Y=V_1=L_{1,0}\oplus L_{1,1}=1(0)L_{1,0}\oplus 1(1)L_{1,1},
\]
so in this case $f$ is the constant 1. If $Y=Y_1^*$, we have $O=\emptyset$, $X_1=\tilde
Y_1$, and then
\[
S_Y=\mathbb R\{\tilde a_{Y_1}\}=L_{1,0}=1^*(0)L_{1,0}\oplus 1^*(1)L_{1,1},
\]
so that $f=1^*$. 

Assume now that the assertion is true for
all $m<n$. By construction, $Y$ is either the tensor
product $Y=Z_1\otimes Z_2$, with
\[
Z_1\sim \{Y_{1},\dots, Y_{m}\},\qquad Z_2\sim\{Y_{{m+1}},\dots, Y_{n}\},
\]
 or $Y$ is the dual of such a product. Let us assume the first case. It is clear that
 $O_{Z_1}\cup O_{Z_2}=O_Y$, and similarly for $I$, so that the corresponding objects
 $X_1,\dots, X_m$ and $X_{m+1},\dots,X_n$  remain the same. By the induction 
assumption, there are functions $f_1\in \Fe_m$ and $f_2\in \Fe_{n-m}$ such that
\[
S_Y=S_{Z_1}\otimes S_{Z_2}=\bigoplus_{\substack{s\in\{0,1\}^{m}\\ t\in
\{0,1\}^{n-m}}}
f_1(s)f_2(t)L_{1,s_{1}}\otimes\dots \otimes L_{m,s_{m}}\otimes
L_{{m+1},t_{1}}\otimes\dots\otimes L_{n,t_{n-m}}.
\]
This implies the assertion, with $f=f_1\otimes f_2$. 

To finish the proof, it is now enough to observe that if the assertion holds for $Y$ then
it also  holds for $Y^*$. So assume that $Y=X_f=(V, A_f(X_1,\dots,X_n))$ for some $f\in \Fe_n$,
then $Y^*=X_f^*=\tilde X_{f^*}=(V^*,A_{f^*}(\tilde X_1,\dots,\tilde X_n)$. 
In is now enough to notice that $\tilde X_i=\tilde{\tilde Y}_i=Y_i$
if $i\in I_{Y}$ and $\tilde X_i=\tilde {Y}_i$ if $i\in O_Y$. Since by definition
$O_{Y^*}=I_Y$, this proves the statement.

\end{proof}

Let us stress that in general, the objects $X_f$ depend on the choice of the elements
$a_{X_i}$. From the above proof, it is clear that  the  description in Proposition
\ref{prop:boolean} does not depend on the choice of the elements $a_{Y_i}\in A_{Y_i}$.


%\begin{exm} Quantum higher order objects from state spaces, \cite{bisio2019theoretical}.

%\end{exm}



%%

\subsection{Type funtions and higher order objects}


Let $\Te_n\subseteq \Fe_n$ be defined as the subset generated from the constant 
function $1$ on $\{0,1\}$ by taking duals and tensor products. For example, we have
\[
\Te_1=\Fe_1=\{1,1^*\},\quad
\Te_2=\{1\otimes 1, (1\otimes 1)^*, 1\otimes 1^*,1^*\otimes 1, (1^*\otimes 1)^*,
(1\otimes 1^*)^*\},
\]
etc.  Elements of $\Te_n$ will be called {\em type functions}. Similarly as for the higher order
objects, the indexes in $[n]$ such that the corresponding
component was subjected to taking the dual an even number of times will be called the
outputs (of $f$) and denoted by $O=O_f$, indexes in $I=I_f:=[n]\setminus O_f$ will be
called inputs. From the proof of Proposition \ref{prop:boolean}, it is easily seen that a
higher order object is of the form $Y=X_f$ for a function $f\in \Te_n$ with the same outputs (and of
course also inputs) as $Y$. We next show that the converse is true. 


\begin{prop}\label{prop:type_hom} Let $\{X_1,\dots, X_n\}$  be first order objects  and let
$f\in \Te_n$. Then $Y=X_f$ is a higher order object with $O_Y=O_f$ and  $Y\sim
\{Y_1,\dots, Y_n\}$, where $Y_i=X_i$ for $i\in O_f$ and $Y_i=\tilde X_i$ for
$i\in I_f$.  

\end{prop}

\begin{proof} As before, we will proceed by induction on $n$. For $n=1$, we only have the
possibilities $f=1$ or $f=1^*$. In the first case, $O=[1]$ and we get
\[
S_f=1L_{1,0}\oplus 1L_{1,1}= V_{1},
\]
so that $X_f=(V_1,\{\tilde a_1\}^\sim)=X_1$. In the second case, $O=\emptyset$ and 
\[
S_f=1L_{1,0}=\mathbb R\{a_1\},
\]
so that $X_f=(V_1,\{a_1\})=\tilde X_1^*$. Assume next that the statement
is true for all $m<n$ and assume that $f=f_1\otimes f_2$ for some $f_1\in \Fe_m$, $f_2\in
\Fe_{n-m}$, then it is easily seen that $Y=Z_1\otimes Z_2$ for $Z_1=X_{f_1}$ and
$Z_2=X_{f_2}$, constructed from $\{X_1,\dots,X_m\}$ resp. $\{X_{m+1},\dots, X_n\}$. 
By the induction assumption, $Z_1$ and $Z_2$ are higher order objects, with
$O_{Z_i}=O_{f_i}$, it follows that $Y$ is a higher order object with $O_Y=O_{Z_1}\cup
O_{Z_2}=O_{f_1}\cup O_{f_2}=O_f$.

Finally, assume that the statement is true for $f\in \Fe_n$, we will show that it holds
for $f^*$. From \eqref{eq:dualityXf}, we see that $X_{f^*}=\tilde X_f$, which shows that 
$X_{f^*}\sim\{\tilde Y_1,\dots, \tilde Y_n\}$. Since taking duals will switch inputs and
outputs, this finishes the proof.




\end{proof}


Let $\{Y_1,\dots, Y_n\}$ be first order objects.
The above results show that any of higher order object  $Y\sim \{Y_1,\dots,Y_n\}$ with
fixed set of outputs $O_Y=O$ satisfies $Y\simeq X_f$ for a unique type function $f\in
\Te_n$, $O_f=O$,  and a fixed set of objects $\{X_1,\dots,X_n\}$, where the isomorphism is given
by the action of some 
permutation in $S_n$ on the space  $V_1\otimes\dots\otimes  V_n$. Conversely, any object
of this form has the above properties. A basic example of such a function is (see Section
\ref{sec:boolean})
\[
p_I(s)= \Pi_{i\in I} \bar s_i=\otimes_{i\in I} 1^*(s_i),\qquad s\in \{0,1\}^n,
\]
where $I=[n]\setminus O$. Clearly, $p_I\in \Te_n$ and the set of outputs of $p_I$ is $O$. It is easy to see that $X_{p_I}\simeq  Y_I^*\otimes Y_O$,
where $Y_I=\otimes_{i\in I} Y_i$ and $Y_O= \otimes_{i\in O} Y_i$ are first order objects, so that the corresponding
higher order object can be identified with the set of replacement channels $Y_I\to Y_O$.
Similarly, the function $p_O^*\in \Te_n$ has output set $O$ and $X_{p_O^*}\simeq
(Y_I\otimes Y_O^*)^*=[Y_I,Y_O]$, the set of all channels $Y_I\to Y_O$. 

\begin{lemma}\label{lemma:fh_setting} Let $f\in\Te_n$ and let $O_f=O$,  $I=I_f$. Then
\[
p_I\le f\le p_O^*.
\]

\end{lemma}

\begin{proof} This is obviously true for $n=1$. Indeed, in this case,
$\Te_1=\Fe_1=\{1=p_\emptyset,1^*=p_{[1]}\}$. If $f=1$, then $O=[1]$, $I=\emptyset$ and 
\[
p_I=p_{\emptyset}=1=p_O^*,
\]
the case  $f=1^*$ is obtained by taking complements. Assume that the assertion holds for
$m<n$. Let $f\in \Te_n$ and assume that  $f=g\otimes h$ for some  $g\in
\Te_m$, $h\in \Te_{n-m}$.  By the assumption,
\[
p_{I_g}\otimes p_{I_h}\le g\otimes h\le p^*_{O_g}\otimes p^*_{O_h}\le (p_{O_g}\otimes
p_{O_f})^*,
\]
the last inequality follows from Lemma \ref{lemma:fproduct}. We have  
$O_f=O_g\cup (m+O_h)$, $I_f=I_g\cup (m+I_h)$, so that $p_{O_f}=p_{O_g}\otimes p_{O_h}$ and
similarly for $p_{I_f}$. Now notice that any $f\in \Te_n$ is either of the form $(f\otimes
g)\circ \sigma$ or of the form $(f\otimes g)^*\circ \sigma$, for some permutation
$\sigma$. Since the inequality is easily seen to be preserved by
permutations, and reversed by duality which also swiches the input and output sets, the
assertion is proved.

\end{proof}


Combining this with the remarks below Lemma \ref{lemma:Xf}, we get the following result
(cf. cite). Recall that a bimorphism in a category is a morphism $X\xrightarrow{\varphi} Y$ which is
both mono and epi, that is, such that
for any pairs of arrows (with appropriate sources and targets) we have $\psi\circ
f=\psi\circ g \iff f=g$ and $k\circ\psi=l\circ\psi \iff k=l$.  It can be shown that the
bimorphisms in $\Af$ are precisely those morphisms that are given by isomorphisms in
$\FV$.


\begin{theorem}\label{thm:setting} Let $Y\sim \{Y_1,\dots, Y_n\}$ be such that $O_Y=O$,
$I_Y=I$. Then there exist bimorphisms 
\[
Y_I^*\otimes Y_O\xrightarrow{\varphi} Y
\xrightarrow{\psi} [Y_I, Y_O].
\]
The bimorphisms are given by permutations. 


\end{theorem}


We will see below that $\Te_n$ is not a lattice for $n\ge 2$, so that for $f_1,f_2\in
\Te_n$, neither of $f_1\wedge f_2$ or $f_1\vee f_2$ has to be a type function.
Nevertheless, we have by the above results that if $O_{f_1}=O_{f_2}$, 
\[
Y_I^*\otimes Y_0 \xrightarrow{\varphi} X_{f_1\wedge f_2}\xrightarrow{id_V} X_{f_1\vee f_2}
\xrightarrow{\psi} [Y_I,Y_O]
\]
for some suitable bimorphisms $\varphi$, $\psi$, moreover, the objects $X_{f_1\wedge f_2}$
and $X_{f_1\vee f_2}$ are obtained as a pullback resp. pushout. It follows that although
these objects may  not be  higher order objects themselves, they are included in some higher order object (e.g.
 $[Y_I,Y_O]$) with the same sets of inputs and outputs. 



We finish this section by showing a simple  way to obtain the output set of a type
function.

\begin{prop}\label{prop:fh_outputs} For $f\in \Te_n$, $i\in O_f$ if and only if $f(e^i)=1$.


\end{prop}


\begin{proof} Let $i\in O_f$, then by Lemma \ref{lemma:fh_setting}, $p_{I_f}(e^i)=1\le
f(e^i)$, so that $f(e^i)=1$. Conversely, if $f(e^i)=1$, then by the other inequality in
lemma \ref{lemma:fh_setting}, $p_{O_f}(e^i)=0$, whence $i\in O_f$.


\end{proof}


\section{Characterizations of type  functions}


We have the following  description of the sets of type functions.

\begin{prop}\label{prop:type_min} The set $\Te_n$ is the smallest subset in $\Fe_n$ such
that:
\begin{enumerate}

\item $\Te_n$  is invariant under permutations: if $f\in \Te_n$, then $f\circ \sigma\in
\Te_n$ for any permutation $\sigma\in S_n$,
\item $\Te_n$  is invariant under taking duals: if $f\in \Te_n$ then $f^*\in \Te_n$,
\item $\Te_m\otimes \Te_n\subseteq \Te_{m+n}$,

\item $\Te_1=\{1,p_1\}=\Fe_1$.


\end{enumerate}

\end{prop}


\begin{proof} It is clear by construction that any system of subsets $\{\Se_n\}_n$ with
these properties must contain the type functions and that $\{\Te_n\}_n$ itself has these
properties.

\end{proof}

Our goal is to find some characterization of the type functions.  We start by looking at some examples and non-examples.

\begin{exm}\label{exm:T2} The type functions for $n=2$ are given as 
\[
s\quad \mapsto   \quad 1,\quad \bar s_1\bar s_2,\quad \bar s_1, \quad 1-\bar s_1+\bar
s_1\bar s_2,
\]
and functions  obtained from these by exchanging $s_1\leftrightarrow s_2$, which gives 6
elements.
It can be seen that $\Fe_n$ has $2^{2^n-1}$ elements, so that $\Fe_2$ has 8
elements in total. The two of them that are not type functions are
\[
g(s)=1-\bar s_1-\bar s_2+2\bar s_1s_2,\qquad g^*(s)=\bar s_1+\bar s_2-\bar s_1\bar s_2.
\]
This can be checked directly from Propositions \ref{lemma:fh_setting} and
\ref{prop:fh_outputs}. Indeed, if $g\in \Te_2$, we would have $O_g=\emptyset$, so that
$p_2\le g\le p_\emptyset^*=p_2$, which is obviously not the case. Clearly, also the
complement $g^*\notin \Te_2$. Notice also that $g^*=p_{\{1\}}\vee p_{\{2\}}$, so that
$\Te_2$ is not a lattice. Since $\Fe_2$ can be identified as a sublattice in $\Fe_n$ for
all $n\ge 2$ as $f\mapsto (s \mapsto f(s_1s_2))$, we see that $\Te_n$, $n\ge 2$ is a  subposet in the distributive lattice 
$\Fe_n$ but itself not a lattice. 


\end{exm}


\subsection{The poset $\Pe_f$}


It will be convenient to use the representation 
\[
f=\sum_{S\subseteq [n]} \hat f_Sp_S,
\]
obtained in Lemma \ref{lemma:Vbasis}. For $f\in \Te_n$, let $\mathcal P_f$ be the subposet in $\mathcal L_n$ of elements such that
$\hat f_S\ne 0$. We will show that $f$ is fully determined by $\Pe_f$. %Can we characterize such subposets? (we cannot so far.) Can we extract
%some information about some 'causal structure' on the indices? 
 We say that a poset $\Pe$  is graded of rank
$k$ if every maximal chain in $\Pe$ has the same length equal to $k$ (recall that the length
of a chain is defined as number of its elements -1). Equivalently,  there is
a unique rank function $\rho: \Pe\to \{0,1,\dots,k\}$ such that $\rho(S)=0$ if $S$ is a
minimal element of $\Pe$ and $\rho(T)=\rho(S)+1$ if $T$ covers $S$, that is, $S\le T$ and for any $R$ such that
$S\le R\le T$ we have $R=T$ or $R=S$. 

\begin{prop}\label{prop:graded} Let $f\in \Te_n$, then $\mathcal P_f$ is a graded poset
with even rank $k\le n$. If $\rho$ is the rank function, then we have
\[
f=\sum_{S\in \mathcal P_f}(-1)^{\rho(S)}p_S.
\]

\end{prop}

Then rank of $\Pe_f$ will be denoted by $r(f)$ and called the rank of $f$. Note that the
assertion means that for $f\in \Te_n$, 
\[
\hat f_S=\begin{dcases} (-1)^{\rho(S)},& \text{if } S\in \Pe_f\\
0, & \text{otherwise}.
\end{dcases}
\]


\begin{proof} 
We first note that the property in the statement is invariant under permutations and
complements. Assume  the statement holds for $f$ and let us take any $\sigma\in S_n$.
It is easily seen from Lemma \ref{lemma:Vbasis} that 
$\widehat{f\circ \sigma}_S=\hat f_{\sigma(S)}$ so that $S\mapsto \sigma(S)$ is an
isomprphism  of  
$\mathcal P_{f\circ \sigma}$ onto $\mathcal P_{f}$. Hence if $\Pe_f$ is graded with rank
function $\rho$, then $\Pe_{f\circ\sigma}$ is graded with the same rank, and rank function
$\rho\circ \sigma$. By the assumption we have 
\[
f\circ\sigma=\sum_{S\in \Pe_f}(-1)^{\rho(S)}p_S\circ\sigma=\sum_{S\in
\Pe_f}(-1)^{\rho(S)}p_{\sigma^{-1}(S)}=\sum_{S\in
\Pe_{f\circ\sigma}}(-1)^{\rho\circ \sigma(S)}p_{S}.
\]

For the complement we write 
\begin{equation}\label{eq:dual_rank}
f^*=1-f+p_n=(1-\hat f_\emptyset)1 -\sum_{\substack{S\in \mathcal P_f\\ \emptyset \ne S,
[n]\ne S}}
(-1)^{\rho(S)}p_S+(1- \hat f_{[n]})p_n.
\end{equation}

If $\emptyset \in \Pe_f$, then $\emptyset$ is the least element of $\Pe_f$, so that 
$\rho(\emptyset)=0$ and therefore $\hat f_\emptyset =
(-1)^0=1$. Similarly, if $[n]\in \Pe_f$, then $[n]$ is the largest element in $\Pe_f$,
hence it is the last element in any maximal chain. It follows that $\rho([n])=k$ and hence
$\hat f_{[n]}=(-1)^k=1$ (since $k$ is even). 
Therefore the equality \eqref{eq:dual_rank} implies that $\mathcal P_{f^*}$ differs from $\mathcal P_f$ only in the bottom  and
top elements:  $\emptyset \in \mathcal P_f$ iff  $\emptyset \notin \mathcal P_{f^*}$
and $p_n \in \mathcal P_f$ iff  $p_n \notin \mathcal P_{f^*}$. It follows that $\mathcal
P_{f^*}$ is graded as well, with rank  equal to $k-2$, $k$ or $k+2$, which in any case
is even. Furthermore, let $\rho^*$ be the rank function of $f^*$, then this also implies 
that for all $S\in \Pe_f$, $S\notin \{\emptyset, [n]\}$, we
have  $\rho^*(S)=\rho(S)\pm 1$, according to whether $\emptyset$ was added or removed. The
statement now follows from \eqref{eq:dual_rank}. 

We now proceed by induction on $n$. For $n=1$, we have $\mathcal L_1=\{\emptyset, [1]\}$ and
$\Te_1=\{1,1^*\}$. For $f=1$, $\mathcal P_f=\{\emptyset\}$ is a singleton, which 
is clearly a graded poset, with rank $k=0$ and trivial rank function $\rho$.  We have
\[
f = 1=p_\emptyset=(-1)^{\rho(\emptyset)}p_\emptyset.
\]
The proof for $f=1^*$ is similar, replacing $\emptyset$ by $[1]$.

To finish the proof, assume that the statement is true for $m<n$ and let $f\in \Te_n$.
Then $f$ is either a permutation of a product of some $f_1\in \Fe_{m}$ and $f_2\in \Te_{n-m}$, or a
dual  of such an element. By the first part of the proof,  we only need to prove
that the statement holds for $f=f_1\otimes f_2$. But in this case, by the induction
assumption, $\Pe_{f_i}$ is graded with even rank $k_i$ and rank function $\rho_i$. We also
have
\[
f=f_1\otimes f_2=\sum_{S\subseteq [m], T\subseteq [m-n]} (\widehat {f_1})_S(\widehat {f_2})_T p_Sp_T=
\sum_{S\subseteq [m], T\subseteq [m-n]}(-1)^{\rho_1(S)+\rho_2(T)}p_{S\cup(m+T)}.
\]
It follows that $\Pe_f=\Pe_{f_1}\times \Pe_{f_2}$ is the product of the two posets, which
is a graded poset with rank $k=k_1+k_2$ and rank function $\rho=\rho_1+\rho_2$. This
proves the statement. 

\end{proof}


We next show that the input and output sets of $f\in \Te_n$ can be obtained from $\Pe_f$. For an
index $i\in [n]$, let  $\Pe_{f,i}:=\{S\in \Pe_f,\ i\in S\}$. Note that $\Pe_{f,i}$ may be
empty.

\begin{prop}\label{prop:pfinput} Let $f\in \Te_n$ and $i\in [n]$. Then
\begin{enumerate}
\item If $\Pe_{f,i}\ne
\emptyset$, then all minimal elements in $\Pe_{f,i}$ have the same rank, which will be
denoted by $r_f(i)$. If $\Pe_{f,i}=\emptyset$, we put $r_f(i):=r(f)+1$. 
\item $i\in O_f$ if and only if $\rho_f(i)$ is odd.

\end{enumerate}
\end{prop}



\begin{proof} Since $\Pe_f\simeq \Pe_{f\circ\sigma}$, it is
quite clear that the two properties are preserved by permutations. We will show that they
are preserved by complementation. Observe first that $\Pe_{f,i}=\emptyset$ if and only if
$\Pe_{f^*,i}=\{[n]\}$, since $\Pe_{f^*}$ differs from $\Pe_f$ only up to adding/removing the least and greatest elements
$\emptyset$ and $[n]$. If $\Pe_{f,i}$ is empty, then $p_S(e^i)=1$ for all $S\in
\Pe_f$, so that $f(e^i)=f(0)=1$ and $i\in O_f$, we also see that $r_f(i)=r(f)+1$ is odd.
If $\Pe_{f,i}=[n]$, then $r_f(i)=\rho_f([n])=r(f)$ by definition of the rank, hence
$r_{f}(i)$ is even. As we have seen, $i\in O_{f^*}=I_f$. 

Let us assume that $\Pe_{f,i}$ is not equal to $\emptyset$ or $\{[n]\}$. Then the same is true
for $\Pe_{f^*,i}$, in fact, it differs from $\Pe_{f,i}$ only up to adding/removing the
maximal element $[n]$. Therefore both posets have the same minimal elements, and by the
proof of Proposition \ref{prop:graded}, we have for any such minimal element $S$ that 
$\rho_{f^*}(S)=\rho_f(S)\pm 1$, depending only on the fact whether $\emptyset
\in \Pe_f$. This implies that the properties are preserved by complementation.  


We will now proceed by induction on $n$ as before. Both  assertions are quite trivial for $n=1$,
so assume the statements hold for $m<n$. It is enough to assume that
$f=g\otimes h$ for some $g\in \Te_m$ and $h\in \Te_{n-m}$. 
Suppose without loss of generality that $i\in [m]$, then clearly $\Pe_{g,i}\ne \emptyset$
and the minimal elements in $\Pe_{f,i}$ are of the form  $S\cup T$, with $S$ minimal in
$\Pe_{g,i}$ and $T$ a minimal in $\Pe_h$. Since $\rho_h(T)=0$ for any minimal element $T$, we have
by the induction assumption
\[
\rho_f(S\cup T)=\rho_g(S)+\rho_h(T)=r_g(i).
\]
The statement (ii) follows from the fact that $i\in O_f$ if and only if $i\in O_g$.


\end{proof}




Napisat toto dolu lepsie,  definicie do prelim, ako vyzera f?

\begin{prop}\label{prop:isom} Let $\ell :[m]\to [n]$ be a map. Let $f\in \Te_n$ and let
\[
g=\sum_{S\subseteq [n]} \hat f_S p_{\ell^{-1}(S)}.
\]
Then $g\in \Te_m$.

\end{prop}

Note that $S\mapsto \ell^{-1}(S)$ defines a homomorphism of the Boolean algebras $\mathcal
L_n$ and $\mathcal L_m$, in particular, it preseves unions and intersections, and
$\ell^{-1}(\emptyset)=\emptyset$, $\ell^{-1}([m])=[n]$. 


\begin{proof} Let us denote $g=\ell(f)$. For any permutation $\sigma\in S_m$, we have
\[
g\circ\sigma=\sum_{S\subseteq [n]} \hat f_S p_{\ell^{-1}(S)}\circ\sigma=\sum_{S\subseteq [n]}
\hat f_S p_{\sigma^{-1}(\ell^{-1}(S))}=(\ell\circ\sigma)(f),
\]
so that $\ell(f)\circ \sigma=(\ell\circ\sigma)(f)$. We can similarly show that for any
$\tau\in S_n$, $\ell(f\circ\tau)=(\tau\circ\ell)(f)$.  We may therefore assume
that either $f=f_1\otimes f_2$ for some $f_1\in \Te_k$, $f_2\in \Te_{n-k}$ or $f$ is the
dual of such a product. We then have
\[
\ell(f)=\sum_{\substack{S\subseteq [k]\\T\subseteq [n-k]}} (\hat f_1)_S (\hat
f_2)_Tp_{\ell^{-1}(S\cup (k+T))}=\sum_{\substack{S\subseteq [k]\\ T\subseteq [n-k]}} (\hat f_1)_S (\hat
f_2)_Tp_{\ell^{-1}(S)\cup \ell^{-1}(k+T)}
\]
Composing by a suitable permutation if
necessary, we may assume that there are some maps $\ell_1:[k_1]\to [k]$ and
$\ell_2:[k_2]\to [n-k]$ such that $\ell^{-1}(S)=\ell^{-1}_1(S)$
for $S\subseteq [k]$ and $\ell^{-1}(k+T)=k_1+\ell^{-1}_2(T)$, $T\subseteq [n-k]$. It follows that 
\[
\ell(f)=\ell_1(f_1)\otimes \ell_2(f_2).
\]
Since $\ell^{-1}(\emptyset)=\emptyset$ and $\ell^{-1}([n])=[m]$, we can infer from
\eqref{eq:dual_rank} that $\ell(f^*)=\ell(f)^*$. Since clearly $\ell(1)=1$, we can prove
the statement  by induction on $n$ as before.


\end{proof}



\subsection{Chains and combs}

 Let $\Pe=\{S_1\subsetneq S_2\subsetneq \dots \subsetneq
S_N\}$ be a chain in $\mathcal L_n$. Then  $\Pe$ is graded with rank $N-1$
and rank function $\rho(S_i)=i-1$. 

\begin{prop}\label{prop:chains} For a chain   $\Pe=\{S_1\subsetneq S_2\subsetneq \dots \subsetneq
S_N\}$, the function  
\[
f=f_\Pe:=\sum_i (-1)^{i-1} p_{S_i}
\]
is a type function if and only if $N$ odd.

\end{prop}

\begin{proof}
By Proposition \ref{prop:graded}, if $f\in \Te_n$, then the rank of $f$ must be even, so
that $N$ must be odd. 
We will show that the converse is true. We proceed by induction on $N$. For $N=1$, we have
$f=p_{S_1}\in \Te_n$. Assume that the statement holds for all odd numbers $M<N$ and let
$\Pe$ be a chain as above. Then we have 
\[
f=p_{S_1}\otimes g\otimes 1_{[n]\setminus S_N}
\]
where $g$ is the function for the chain $\emptyset=S'_1\subsetneq S'_2\subsetneq \dots
\subsetneq S'_N$, with $S'_i:=S_i\setminus S_1$. Since $f$ is a type function if $g$ is, this shows that we may assume that 
the chain contains $\emptyset$ and $[n]$.  But then 
\[
f=1+\sum_{j=2}^{N-1} (-1)^{j-1}p_{S_j}+ p_n 
\]
and
\[
f^*=1-f+p_n=\sum_{j=1}^{N-2} (-1)^{j-1}p_{T_j},
\]
where $T_j:=S_{j+1}$. By the induction assumption $f^*\in \Te_n$, hence also $f=f^{**}\in
\Te_n$.
\end{proof}


As we can see from Example \ref{exm:T2}, all elements in $\Te_2$ are chains. This is
also true for $n=3$. Indeed, up to a permutation that does not change the chain structure, 
any $f\in \Te_3$ is either a product of two elements $g\in \Te_2$ and $h\in \Te_1$,
or the dual of such a  product. Since $g$ must be a chain and $|\Pe_h|=1$, their product
must be a chain as well. Taking the dual of a chain only adds/removes the least/largest
elements, so the dual of a chain must be a chain as well.

We now show that chains correspond to important higher order objects. Let $k$ be odd and let $\Pe=\{\emptyset\subsetneq S_1\subsetneq \dots
\subsetneq S_k\subsetneq [n]\}$. Let $f=f_\Pe$, then $f$ is a type function. By
Proposition \ref{prop:type_hom}, for any first order objects $X_1,\dots,X_n$, $Y=X_f$ is a
higher order object such that $Y\sim\{Y_1,\dots,Y_n\}$. 

\begin{prop}\label{prop:chains_combs}  Let $T_1=S_1$, $T_i=S_i\setminus S_{i-1}$ for
$i=1,\dots, k$ and $T_{k+1}=S_k^c$. For $S\subseteq [n]$, we denote  $Y_S:=\otimes_{i\in
S}Y_i$. Then for  $k=1$, $Y\simeq [Y_{T_2},Y_{T_1}]$ and for any odd $k>1$, 
 \[
Y\simeq [Y_{T_{k+1}},[[Y_{T_k},[[....],Y_{T_2}]],Y_{T_1}]].
 \]
\end{prop}

Remark (quantum) comb.

\begin{proof} It is easily checked by Proposition \ref{prop:fh_outputs} that $T_i\subseteq
O_f$ if  $i$ is odd and $T_i\subseteq I_f$ otherwise. We therefore have 
\[
Y_{T_i}=\begin{dcases} \otimes_{i\in T_i}X_i,  & \text{ if } i\text{ is odd},\\
\otimes_{i\in T_i}\tilde X_i,& \text{ if }i\text{ is even}.
\end{dcases}
\]
Let $k=1$, then $f=1-p_{T_1}+p_n$, and $f^*=p_{T_1}=p_{T_1}\otimes 1_{T_2}$. Then
$X_f=\tilde X_{f^*}^*$, and we see that $\tilde X_{f^*}= X_{T_1}^*\otimes \tilde
X_{T_2}=Y^*_{T_1}\otimes Y_{T_2}$. It
follows that $X_f= (Y_{T_1}^*\otimes Y_{T_2})^*\simeq [Y_{T_2}, Y_{T_1}]$, where the
isomorphism is given by swapping the spaces $V_{T_1}^*$ and $V_{T_2}$. Assume the assertion is
true for $k-2$. 
As in the proof of Proposition \ref{prop:chains}, we see that 
\[
f^*=\sum_{i=1}^k (-1)^{i-1}p_{S_i}=p_{T_1}\otimes g\otimes 1_{T_{k+1}}
\]
where $g=1-\sum_{i=2}^{k-1}(-1)^{i-1}p_{S'_i}+ p_{S_k'}$ is the function for the chain
$\Pe'=\{\emptyset\subsetneq S_2'\subsetneq \dots\subsetneq S'_k\}$ in $S'_k\simeq [n']$ for
 $n'=|S'_k|$, $S_i'=S_i\setminus S_1=\cup_{j=2}^i T_j$. We have 
\[
X_f=\tilde X^*_{f^*}=(X_{Y_1}^*\otimes \tilde X_g\otimes \tilde X_{T_{k+1}})^*\simeq (\tilde
X_{T_{k+1}}\otimes [\tilde X_g,X_{T_1}]^*)^*=[\tilde X_{T_{k+1}},[\tilde X_g,
X_{T_1}]].
\]
Here we have used the fact that $\tilde X_{f^*}$ is constructed from $\tilde
X_1,\dots,\tilde X_n$. By induction assumption, we get
\[
[\tilde X_{T_{k+1}},[\tilde X_g,X_{T_1}]]= [\tilde X_{T_{k+1}},[[X_{T_k},[[....],\tilde
X_{T_2}]],X_{T_1}],
\]
which is as required.



\end{proof}




\subsection{Separating type functions}


We say that a function $f\in \Fe_n$ separates $i,j\in [n]$ if $f\neq f^{ij}$, where
$f^{ij}\in \Fe_n$ is such that for any $s\in \{0,1\}^n$,  $f^{ij}(s)=f(\hat s^{ij})$,
here $\hat s^{ij}$ is the string obtained from $s$ by replacing both $s_i$ and $s_j$ by
$s_i\vee s_j$. Equivalently, there exists some $S\in \Pe_f$ such that $S\cap\{i,j\}$ is a
singleton. 

To see this equivalence, note that 
$p_S(s)=p_S(\hat s^{ij})$ whenever $\{i,j\}\subseteq S$ or $\{i,j\}\cap S=\emptyset$. 
Hence, if $f$ separates $i$ and $j$, there must be at least one $S\in \Pe_f$ that contains one of
the indices but not the other. Conversely, let $S$ be 
minimal with the property that, say, $i\in S$ and $j\notin S$. Let $s$ be the string such
that $s_k=0$ if and only if $k\in S$, in particular, $s_i=0$, $s_j=1$ and $s_i\vee s_j=1$. Then
\[
f(s)=\sum_{T\subseteq S} \hat f_Tp_T(s)=\sum_{T\subseteq S\setminus\{i\}}\hat
f_Tp_T(s)+\hat f_Sp_S(s),
\]
the second equality follows from the fact that $S$ is minimal set with $\hat f_S\ne 0$
containing $i$ but not $j$. On the other hand, 
\[
f(\hat s^{ij})=\sum_{T\subseteq S\setminus\{i\}} \hat f_T(s),
\]
so that $f(s)-f^{ij}(s)=\hat f_S\ne 0$.



\begin{lemma}\label{lemma:separateij} Let $f\in \Fe_n$ and assume that $f$ does not separate $i$ and $j$. Then
there is some $g\in \Fe_{n-1}$ such that $f(s)=g(s^{ij}(s_i\vee s_j))$. We have
$\Pe_f\simeq \Pe_g$ (as posets) and $f\in \Te_n$ if and only if $g\in \Te_{n-1}$.




\end{lemma}


\begin{proof} We may assume $i=n-1$, $j=n$. Put $g(s_1\dots s_{n-1}):= f(s_1\dots
s_{n-1}s_{n-1})$. Then clearly $g\in \Fe_{n-1}$ and for $s\in \{0,1\}^n$, 
\[
g(s_1\dots s_{n-2}(s_{n-1}\vee s_n))=f(\hat s^{n(n-1)})=f(s).
\]
Since any $S\in \Pe_f$ either contains none of $n-1,n$ or both of them, we have
\begin{align*}
g(s_1\dots s_{n-1})&=f(s_1\dots s_{n-1}s_{n-1})=\sum_{S\subseteq [n]} \hat f_S p_S(s_1
\dots s_{n-1}s_{n-1})\\
&= \sum_{S\subseteq [n-2]}\hat f_Sp_S(s_1\dots s_{n-1})+\sum_{\substack{S\subseteq [n]\\
\{n-1,n\}\subseteq S}} \hat f_Sp_S(s_1\dots s_{n-1}s_{n-1})\\
&= \sum_{S\subseteq [n]} \hat f_Sp_{S\setminus\{n\}}(s_1\dots s_{n-1}).
\end{align*}
Note that for $S\subseteq [n]$, we have $S\setminus \{n\}=\ell^{-1}(S)$, where $\ell$ is
the inclusion map $[n-1]\hookrightarrow [n]$. It follows by Proposition \ref{prop:isom}
that if $f\in \Te_n$ then $g\in \Te_{n-1}$. Moreover, $\ell^{-1}$ is not injective on
$\mathcal L_n$, since $\ell$ is not surjective, but its restriction to $\Pe_f$ is, so that 
$\Pe_f\simeq \Pe_g$. 

Assume $g\in\Te_{n-1}$, then since $\overline {s_{n-1}\vee s_n}=\bar s_{n-1}\bar s_n$, we
get
\begin{align*}
f(s)&=\sum_{T\subseteq [n-1]}\hat g_Tp_T(s_1\dots s_{n-2}(s_{n-1}\vee s_n))\\
&= \sum_{T\subseteq [n-2]}\hat g_Tp_T(s)+ \sum_{T\subseteq [n-1], n-1\in T}\hat
g_Tp_{T\cup \{n\}}(s)=\sum_{T\subseteq [n-1]} \hat g_Tp_{\ell_1^{-1}(T)}(s),
\end{align*}
were $\ell_1: [n]\to [n-1]$ is the map such that $\ell_1(i)=i$ for $i\ne n$ and
$\ell_1(n)=n-1$. Again, using Proposition \ref{prop:isom}, this implies that $f\in \Te_n$.



\end{proof}

We say that $f$ is separating, or separates the poits of $[n]$, if it separates all pairs $i,j\in [n]$.
Notice that in this case both $\cap \Pe_f$ and $(\cup\Pe_f)^c$ are at most singletons.


\begin{theorem}\label{thm:separates} For any $f\in \Te_n$ there is some $g\in \Te_k$ such
that $g$ is separating, $\Pe_f\simeq \Pe_g$ and there are subsets $S_1,\dots, S_l$ in
$[n]$ such that $f(s)=g(s^{\cup_j S_j}(\vee_{j\in I_1} s_j)\dots (\vee_{j\in I_l} s_j))$.

\end{theorem}

\begin{proof} We can construct the function $g$ by repeated application of Lemma
\ref{lemma:separateij}, glueing together nonseparable points until, after a finite number
of steps, none are left, so that the resulting function $g$ separates the points of $m$.

\end{proof}

Let us remark that  the higher order object constructed from $f$ and a set of first order
objects $X_1,\dots, X_n$ is isomorphic to the object constructed from $g$ and a sequence
$Z_1,\dots, Z_k$, which is obtained by removing the first order objects $X_i$, $i\in S_j$
and replacing them by their tensor product
$\otimes_{i\in S_j} X_i$, for any set of nonseparable indices $S_j$.


\subsubsection{Separating chains}


We will describe all separating chains, up to permutations. 
Clearly, a chain $\Pe=\{S_1\subsetneq \dots \subsetneq
S_N\}$ in $\mathcal L_n$  is
separating if and only if  $S_i\setminus S_{i-1}$ is a singleton for $i=2,\dots, N$ and
both $S_1$ and $S_N^c$ are at most singletons (that is, these might be also empty). 
We have seen that the correspnding function is in $\Te_n$ if and only if $N=r(\Pe)+1$ is
odd. By the separating property, we must have $n-1\le N\le n+1$, depending on whether
$S_1$ or $S_N^C$ are empty or not.
 Since $N$ must be  odd, we see that the only possibilities are
\begin{align*}
N&=n-1 \text{ or } N=n+1  & \text{ if $n$ is even}\\
N&=n & \text{ if $n$ is odd}.
\end{align*}
For even $n$, put
\[
\gamma_n(s):=\sum_{l=0}^n (-1)^lp_{[l]}(s)=1-\bar s_1+\bar s_1\bar s_2-\dots +\bar
s_1\dots \bar s_n.
\]
Then $\gamma_n$  is a separating chain in $\Te_n$ and the corresponding sets of input and output
indices  are
\[
I=\{2j, j=1,\dots n/2\},\qquad O=\{2j-1,\ j=1,\dots n/2\}.
\]
Up to a permutation, any separating chain in $\Te_n$ is of the form 
\[
f=\gamma_n \text{ or }\   f=p_1\otimes\gamma_{n-2}\otimes 1_1.
\]
These two chains  are easily seen to be each others complement.
Similarly, if $n$ is odd, then (up to permutation) any separating chain in $\Te_n$  must either of the two
comlementary  forms
\[
f=p_1\otimes \gamma_{n-1}  \text{ or }\  f=\gamma_{n-1}\otimes 1_1.
\]
 From this and Example \ref{ex:chains}, we see
that there are basically  two separating elements in $\Te_2$:  
\[
f=\gamma_2,\qquad f^*=p_1\otimes 1_1.
\]
Similarly, there are basically  two complementary forms of  separating elements in $\Te_3$: 
\[
f=p_1\otimes \gamma_2,\qquad f^*= \gamma_2\otimes 1_1. 
\]








\end{document}
\end{document}


In other words, the outputs of $f$ are precisely those indices for which the sum of the
coefficients $\hat f_S$ over the facet $\{S\in \mathcal L_n,\ i\notin S\}$ is 1.










The above theorem shows that any element $Y\sim\{X_1,\dots,X_n\}$ is (up to a possible permutation
of the involved first order objects)
determined by a unique boolean function $f=f_Y:\{0,1\}^n\to \{0,1\}$. . Functions
obtained in this way will be called type functions and studied in more detail in
Section \ref{sec:type}. 
It is rather obvious that not all boolean functions are type functions, for
example, for $Y\sim \{X\}$ we only have $Y=X$ and $Y=X^*$, which corresponds to constant
1 and the negation, respectively. 

In general, one can see from the above proof that we
necessarily have 
\[
f\in \Fe_n=\{g:\{0,1\}^n\to \{0,1\},\ g(0)=1\}
\]
for any type function $f$. Note that the set $\Fe_n$ is a boolean algebra, with smallest
element $1^*$ and largest element $1$, see Section
\ref{sec:}. Pick any element $f\in \Fe_n$ and any permutation $\pi\in S_n$ and let
$\sigma_\pi: X_1\otimes\dots\otimes  X_n\to X_{\sigma^{-1}(1)}\otimes \dots X_{\sigma^{-1}(n)}$ be the
corresponding symmetry. Keeping the notations in \eqref{eq:subspaces},  let 
\[
S_{\pi,f}:=\bigoplus_{s\in \{0,1\}^n} f(s)\sigma_\pi(L_s),\qquad
A_{\pi,f}:=S_{\pi,f}\cap\{\sigma_\pi(\tilde a_Y)\}^\sim,\qquad
V_\pi:=\sigma_\pi(\otimes_{j}V_{j}).
\]

\begin{prop}\label{prop:xpif} Let $f,f_1,f_2\in \Fe_n$, $\pi,\pi_1,\pi_2
\in S_n$. Then 
\begin{enumerate}
\item[(i)]  $X_{\pi,f}:=(V_\pi, A_{\pi,f})$ is an
object in $\Af$.
\item[(ii)] For the smallest and the largest element, we have  
\[
X_{\pi,1^*}=(V_\pi, \{\sigma_\pi(a_Y)\}),\qquad X_{\pi,1}=(V_\pi,\{\sigma_\pi(\tilde
a_Y)\}^\sim).
\]
\item[(iii)] If $f_1\le f_2$, then 
$\sigma_{\pi_2}\circ\sigma_{\pi_1}^{-1}$ is a morphism $X_{\pi_1,f_1}\to X_{\pi_2,f_2}$ in
$\Af$.
\item[(iv)] The diagram
\[
\xymatrixcolsep{5pc}\xymatrixrowsep{3pc}\xymatrix{
X_{\pi,f_1\wedge
f_2}\ar[r]^{\sigma_{\pi_1}\circ\sigma^{-1}_\pi}
\ar[d]_{\sigma_{\pi_2}\circ\sigma^{-1}_\pi} & X_{\pi_1,f_1}\ar[d]^{\sigma_\pi^{-1}} \\
X_{\pi_2,f_2} \ar[r]_{\sigma_\pi^{-1}}& X_{id,1} 
}
\]
is a pullback.
\item[(v)] The diagram
\[
\xymatrixcolsep{5pc}\xymatrixrowsep{3pc}\xymatrix{
X_{id,1^*}\ar[r]^{\sigma_{\pi_1}}
\ar[d]_{\sigma_{\pi_2}} & X_{\pi_1,f_1}\ar[d]^{\sigma_\pi\circ\sigma_{\pi_1}^{-1}} \\
X_{\pi_2,f_2} \ar[r]_{\sigma_\pi\circ\sigma_{\pi_1}^{-1}}& X_{\pi, f_1\vee f_2} 
}
\]
is a pushout.
\end{enumerate}


\end{prop}


Then $A_{\pi,f}$ is a proper affinne subspace in $V_\pi:=\sigma_\pi(\otimes_{j}V_{j})$, this folows from the
fact that $f(0)=1$, so that $S$ contains the subspace $\mathbb R a$. 
Then $Y_f:=(\otimes_{j}V_{i_j},A_f)$ defines an object in $\Af$ such that $a\in A_f$ and
$\tilde a\in \tilde A_f$. Such objects might not belong to $\Afh$ in
general.
With the pointwise ordering, $\Fe_n$ is a distributive lattice, with the smallest element
$\chi_0$ and largest element $1$.  It is easy to see that for  $f,g\in \Fe_n$ and some
corresponding objects $Y_f$, $Y_g$, we have $f\le g$  if
and only if there is some permutation $\sigma\in S_n$ such that 
$Y_f\xrightarrow{\sigma} Y_g$. In particular, since $\chi_0\le f\le 1$ for all $f\in
\Fe_n$, there is some permutation $\sigma$ such that 
\[
Y_{\min}\xrightarrow{\sigma} Y_f\xrightarrow{\sigma^{-1}} Y_{\max},
\]
where 
\[
Y_{\min}:=(V_1\otimes\dots\otimes V_n, \{a_1\otimes\dots\otimes a_n\}),\qquad
Y_{\max}:=(V_1\otimes \dots\otimes V_n,\{\tilde a_1\otimes\dots\otimes \tilde a_n\}^\sim).
\]
If $Y_g$ is an object such that 
\[
Y_{\min}\xrightarrow{\rho} Y_g\xrightarrow{\rho^{-1}} Y_{\max},
\]
for a permutation $\rho$, then we may define an object corresponding to $f\wedge g$ as the
pullback of the two arrows $f\xrightarrow{\sigma^{-1}} Y_{\max}$ and
$g\xrightarrow{\rho^{-1}} Y_{\max}$, similarly, $Y_{f\vee g}$ can be found as a pushout.


-----



It is also shown that we can introduce a tensor product $\otimes$
and duality $(-)^*$ such that $\Af$ with these structures becomes a *-autonomous category.
We will show that we may use this category to describe classical and quantum higher order
maps. 


To this end, we introduce a subcategory in  $\Af$, consisting of objects $X=(V_X,A_X)$, where the vector
space $V_X$ is restricted to be either $\mathbb R^n$ or $M_n^h$ (see Example \ref{exm:}). 
Accordingly, let also $V_X^+$ be either $\mathbb R^n_+$ (the cone of elements in $\mathbb R^n$
with nonnegative coordinates) or  $M_n^+$ (the cone of positive semi-definite matrices).
We then also require that both $A_X$ and $\tilde A_X$ contain some interior elements in
$V_X^+$ (note that in this case we identify $V_X=V_X^*$). The morphisms are restricted so
that we additionaly require that $(V_X,A_X)\xrightarrow{f}(V_Y,A_Y)$ are completely
positive.





and morphisms  $(\mathbb R^n,A)\xrightarrow{f} (\mathbb R^m,B)$  
in $\Af$ such that we also have $f(\mathbb R^n_+)\subseteq \mathbb R^m_+$. The category
$\Quant$ consists of objects of the form $X=(M_n,A)$ and morphisms
$(M_n,A)\xrightarrow{f} (M_m,B)$ in $\Af$ such that $f(M_n^+)\subseteq M_m^+$.



For any object $X$, we also put 
\[
L_X:=\lin(A_X)\qquad S_X:=\Span(A_X),\qquad  d_X:=\dim(L_X),\qquad D_X:=\dim(V_X).
\]
Note that $X$ is
uniquely determined also by the triple $(V_X,L_X,a_X)$ with  an element $a_X\in A_X$, or
by $(V_X,S_X,\tilde a_X)$ with an element $\tilde a_X\in \tilde A_X$. 

We will consider the following special kind of morphisms in $\Af$. 
A morphism $X\xrightarrow{f} Y$ is a monomorphism if $f\circ h=f\circ g$ implies $h=g$ for
any morphisms $g$, $h$, and an epimorphism if $h\circ f=g\circ f$ implies $h=g$. A
morphism that is both mono and epi is called a bimorphism.


\begin{lemma}\label{lemma:epimono} A morphism $X\xrightarrow{f} Y$ is a  monomorphism if and only
if  it is injective as a map $f:V_X\to V_Y$. Similarly, $f$ is an epimorphism if and only if it is surjective. 

\end{lemma}

Consequently, $f$ is a bimorphism if and only if  it is an isomorphism of $V_X$ and $V_Y$. Note that a
bimorphism is not necessarily an isomorphism in $\Af$, which would mean that the inverse
map satisfies $f^{-1}(A_Y)\subseteq A_X$.

\begin{proof} Let $f$ be a monomorphism in $\Af$
and let $K=Ker(f)$. Let $Z=(V_X\times K, A_X\times \{0\})$, then $Z$ is an object in
$\Af$. Let $g,h:V_Z\to V_X$ be defined as $g(x,y)=x$, $h(x,y)=x+y$, then
$g,h:Z\to X$ are morphisms in $\Af$ and we have
\[
f\circ g(x,y)=f(x)=f(x)+f(y)=f\circ h(x,y),\qquad \forall (x,y)\in V_Z.
\]
Hence $h=g$, so that we must have $K=\{0\}$ and $f$ is injective. The converse is clear.

Similarly, let  $f$ be an epimorphism and let $R=f(V_X)\subseteq V_Y$. Let $Z=(V_Y\times
V_Y|_R,
A_Y\times \{[0]\})$ and let $g,h:V_Y\to V_Z$ be given by $g(y)= (y,[0])$, $h(y)=(y, q(y))$,
where $q:V_Y\to V_Y|_R$ is the quotient map. Since $A_Y\subseteq R$, we have
$q(A_Y)=\{[0]\}$, so that both $g,h$ are morphisms in $\Af$. Moreover,
\[
g\circ f(x)=(f(x),[0])=(f(x),q(f(x)))= h\circ f,
\]
so that $g=h$, but this implies that $R=V_Y$ and $f$ is surjective. The converse is clear.


\end{proof}


Let $X,Y, Z$ be objects in $\Af$ such that there are bimorphisms 
\[
Z\xrightarrow{f} X,\qquad Z\xrightarrow{g} Y.
\]
Note that in particular $\psi:=f\circ g^{-1}$ is an isomorphism of $V_Y$ onto $V_X$. 
%Let us also assume that there is some $\tilde a_x\in \tilde A_X$ such that $\psi^*(\tilde
%a_X)\in \tilde A_Y$. 

Let us define  $X\sqcup_{f,g} Y:=(V_X,A_{X\sqcup_{f,g} Y})$, with 
\[
A_{X\sqcup_{f,g} Y}=\{sa+(1-s)\psi(b),\ a\in A_X,\ b\in A_Y,\ s\in \mathbb R\}.
\]
Note first that this is a proper object in $\Af$ if and only if 
\begin{equation}\label{eq:pushout_cond}
\forall b\in A_Y,\quad t\psi(b)\in A_X \ \implies \ t=1.
\end{equation}
Indeed, we only have to check that
$0\notin A_{X\sqcup_{f,g}Y}$ which is easily seen to be equivalent to
\eqref{eq:pushout_cond}. 

Assume \eqref{eq:pushout_cond}, then $X\sqcup_{f,g} Y$ together with the morphisms given by the linear maps
$id:V_X\to V_X$ and $\psi:V_Y\to V_X$,  is the \textbf{pushout} of the above diagram. Indeed, these are clearly bimorphisms $X\to X\sqcup_{f,g} Y$ and $Y\to X\sqcup_{f,g} Y$ in $\Af$, and we have 
\[
id\circ f=f=\psi\circ g.
\]
Also, if  $W$ is an object in $\Af$ and $X\xrightarrow{i} W$ and $Y\xrightarrow{j} W$ are such that $i\circ f=j\circ
g$, then $i=i\circ id$, $j=i\circ \psi$, so the map $i$ defines a morphism
$X\sqcup_{f_0,g_0} Y\to W$,
obviously unique, with the required properties. We have
\[
L_{X\sqcup_{f,g}Y}=L_X\vee \psi(L_Y),\qquad S_{X\sqcup_{f,g}Y}=S_X\vee
\psi(S_Y).
\]
Let us also note that if \eqref{eq:pushout_cond} is not satisfied,  there is some $z\in V_Z$ such
that for some $t\ne 1$,
\[
tf(z)\in A_X,\qquad g(z)\in A_Y.
\]
If there are some $X\xrightarrow{i} W$ and $Y\xrightarrow{j} W$ as above, then 
$ti\circ f(z)\in A_W$, but also $i\circ f(z)=j\circ g(z)\in A_W$, so that $W$ is not a
proper object, in this case the pushout is the terminal object $0$, with the unique arrows
$X\xrightarrow{!} 0$, $Y\xrightarrow{!} 0$.

Similarly, let 
\[
X\xrightarrow{f} Z,\qquad Y\xrightarrow{g} Z
\]
be  bimorphisms and let $\psi=f^{-1}\circ g$. If 
\begin{equation}\label{eq:pullback_cond}
\phi(A_Y)\cap A_X\ne \emptyset,
\end{equation}
 the \textbf{pullback} of $f, g$ is
$X\sqcap_{f,g}Y=(V_X, A_X\cap \phi(A_Y))$, 
with  the bimorphisms given by $id_X$ and $\phi^{-1}$. In this case
\[
L_{X\sqcap_{f,g}Y}=L_X\cap \phi(L_Y),\qquad S_{X\sqcap_{f,g}Y}=S_X\cap \phi(S_Y).
\]
Without  condition \eqref{eq:pullback_cond}, the above is not a proper object and in 
this case the pulback is the initial object $\emptyset$.



\appendix

\subsection{Affine subspaces}

A subset $A\subseteq V$ of a finite dimensional vector space $V$ is an affine subspace if 
$\sum_i\alpha_i a_i\in A$ whenever all $a_i\in A$ and $\sum_i\alpha_i=1$. We say that $A$
is proper if $0\ne A$ and $A\ne \emptyset$. We will always
mean  that an affine subspace is proper (if not explicitly stated otherwise).

\subsubsection{Description}
An affine
subspace can be determined in two ways:
\begin{enumerate}
\item[(i)] Let $L\subseteq V$ be a linear subspace and $a_0\ne L$. Then 
\[
A=a_0+L
\]
is a proper affine subspace.  Note that $a_0\in A$ and $A\cap L=\emptyset$.
Conversely, any proper affine subspace $A$ can be given in this way, with $a_0$ an arbitrary element in $A$ and
\[
L=\lin(A):=\{a_1-a_2,\ a_1,a_2\in A\}=\{a-a_0,\ a\in A\}.
\]
\item[(ii)] Let $S\subseteq V$ be a linear subspace and $a_0^*\in V^*\setminus S^\perp$. Then
\[
A=\{a\in S, \<a_0^*,a\>=1\}
\]
is a proper affine subspace. Conversely, any proper affine subspace $A$ is given in this way, with
$S=\Span(A)$ and $a_0^*$ an arbitrary element in the dual 
\[
\tilde A=\{a^*\in V^*,\ \<a^*,a\>=1,\ \forall a\in A\}.
\]
\end{enumerate}

For an affine subspace $A$, the relation of $L=\lin(A)$ and $S=\Span(A)$ is as follows:
\[
S=L+\mathbb R a,\qquad L=S\cap \{\tilde a\}^\perp,
\]
here $a\in A$ and $\tilde a\in \tilde A$ are arbitrary elements.


\subsubsection{Duality}

For an affine subspace $A$,  $\tilde A$ is an affine subspace as well. If $A$ is proper,
then $\tilde A$ is proper and we have
$\tilde{\tilde A}=A$. More generally, if $\emptyset\ne C\subseteq A$ is any  subset of a
proper  affine
subspace $A$, then $\tilde C$ is a proper affine subspace 
and $\tilde{\tilde C}$ is the affine hull of $C$, that is,
\[
\tilde{\tilde C}=\aff(C):=\{\sum_i \alpha_i c_i,\ c_i\in C,\ \sum_i\alpha_i=1\}.
\]
In this case, we may write $\tilde{\tilde C}$ as
\[
\tilde{\tilde C}=c_0+\lin(C)=c_0+\Span(\{c_1-c_2,\ c_1,c_2\in C\})
\]
with an arbitrary element $c_0\in C$, or as
\[
\tilde{\tilde C}=\{c\in \Span(C),\ \<a_0^*,c\>=1\}
\]
for an arbitrary element $a_0^*\in \tilde A$.

\begin{lemma}\label{lemma:duality}
Let $A$ be a proper affine subspace and let $C\subseteq A$ be any subset. Then
\begin{align*}
\lin(C)&=\lin(\tilde{\tilde C})=\tilde
C^\perp=\Span(\tilde C)^\perp,&  \lin(\tilde C)&=C^\perp=\Span(C)^\perp \\
\Span(C)&=C^{\perp\perp} =\lin(\tilde C)^\perp,&  \Span(\tilde C)&=\lin(C)^\perp.
\end{align*}


\end{lemma}


\subsubsection{The lattice of affine subspaces}

Let $\Ae(V)$ be the set of all affine subspaces in a finite dimensional vector space $V$.
Then $\Ae(V)$ can be ordered by inclusion and it is a complete lattice, with
\[
\wedge \Ae=\cap \Ae,\qquad \vee \Ae = \{\sum_i\alpha_i a_i,\ a_i\in A_i\in \Ae,
\sum_i\alpha_i=1\}
\]
for any subset $\Ae\subseteq \Ae(V)$. Let us choose any nonzero elements $a\in V$,
$\tilde a\in V^*$ and put
\[
\Ae_{a,\tilde a}(V)=\{A\in \Ae(V),\ a\in A,\ \tilde a\in \tilde A\}.
\]
Note that any subspace in $\Ae_{a,\tilde a}$ is proper and it is a complete sublattice in
$\Ae(V)$. Moreover, we have
\[
\lin(\wedge\Ae)=\wedge\{\lin(A),\ A\in \Ae\},\qquad \lin(\vee\Ae)=\vee\{\lin(A),\ A\in \Ae\}
\]
and similarly for $\Span$. 

We say that $A,B\in \Ae_{a,\tilde a}(V)$ are independent if $A\cap B=\{a\}$, equivalently,
$\lin(A)\cap\lin(B)=\{0\}$, that is, $\lin(A)$ and $\lin(B)$ are independent linear
subspaces. A family $\{A_1,\dots,A_n\}\subseteq \Ae_{a,\tilde a}(V)$ is independent if
$A_i$ and $\vee_{j\in I}A_j$ are independent for any $i\in \{1,\dots,n\}$ and $i\ne
I\subseteq\{1,\dots,n\}$. Equivalently, $\{\lin(A_1),\dots,\lin(A_n)\}$ is an independent
family of subspaces in $V$. 

\begin{lemma}\label{lemma:affine_distributive} Let $\{A_1,\dots,A_n\}\subseteq
\Ae_{a,\tilde a}(V)$ be an independent family. Then the sublattice generated by
$\{A_1,\dots,A_n\}$ is distributive.



\end{lemma}

\begin{proof} Clear from a similar property of linear subspaces.   

\end{proof}




\subsubsection{Limits and colimits}

Limits and colimits should be obtained from those in $\FV$, we have to spectify the other
structures and check  whether the corresponding arrows are in $\Af$. 

\medskip

First, note that $\{0\}$ is both initial and terminal in $\FV$. In $\Af$, it is easily
seen that $\emptyset$ is {initial} and $0$ is {terminal} in $\Af$. 

Let $\bX$, $\bY$ be two objects in $\Af$. Assume first that both are proper. We define
their {product} as
\[
\bX\times \bY:=(V_\bX\times V_\bY, A_\bX\times A_\bY, (a_X,a_Y), \frac12(\tilde a_X,\tilde
a_Y)),
\]
where 
\[
A_\bX\times A_\bY:=\{(x,y)\in V_\bX\times V_\bY,\ x\in A_\bX, y\in A_\bY\}
\]
is the direct product of $A_\bX$ and $A_\bY$. It is easily verified that this is indeed an
affine subspace and the usual projections $\pi_\bX:V_\bX\times V_\bY\to V_\bX$ and $\pi_\bY:V_\bX\times
V_\bY\to V_\bY$ are in $\Af$. Moreover, for $f:\bZ\to \bX$  and $g:\bZ\to \bY$, the map
$f\times g(z)=(f(z),g(z))$ is also clearly a morphism $\bZ\to \bX\times\bY$  in $\Af$. 
We have
\[
L_{X\times Y}=L_X\times L_Y,\qquad S_{X\times Y}= (L_X\times L_Y)\vee \mathbb R(a_X,a_Y)=(S_X\times S_Y)\wedge \{(\tilde
a_X,-\tilde a_Y)\}^\perp
\]
for an arbitrary choice $a_X\in A_X$, $a_Y\in A_Y$ and $\tilde a_X\in \tilde A_X$, $\tilde
a_Y\in \tilde A_Y$.

Next, we put $X\times \emptyset=\emptyset$, with the unique morphisms $\pi_X:\emptyset \to X$
and $\pi_{\emptyset}:\emptyset \to \emptyset$. If $Y\xrightarrow{f}X$ and
$Y\xrightarrow{g} \emptyset$, then it is clear that $Y=\emptyset$, this shows that this is
indeed the product. Further, put  $X\times 0=X$, with $\pi_X=id_X$  and
$\pi_0: X\xrightarrow{!}0$. It is also readily verified that this is the product.

\medskip

The coproduct for proper objects $X$, $Y$ is defined as 
\[
\bX\oplus \bY=(V_\bX\times V_\bY, A_\bX\oplus A_\bY)
\]
where 
\[
A_\bX\oplus A_\bY:=\{(tx,(1-t)y),\ x\in A_{\bX}, y\in A_\bY,\ t\in \mathbb R\}
\]
is the direct sum. To check that this is an affine subspace, let $x_i\in A_\bX$, $y_i\in A_\bY$, $s_i\in
\mathbb R$ and let $\sum_i\alpha_i=1$, then 
\[
\sum_i\alpha_i(s_ix_i,(1-s_i)y_i)=(\sum_is_i\alpha_ix_i,\sum_i(1-s_i)\alpha_iy_i)=(sx,(1-s)y)\in
A_\bX\oplus A_\bY,
\]
where $s=\sum_is_i\alpha_i$, $x=s^{-1}\sum_is_i\alpha_ix_i$ if $s\ne 0$ and is arbitrary
in $A_\bX$ otherwise, similarly $y=(1-s)^{-1}\sum_i(1-s_i)\alpha_iy_i$ if $s\ne 1$ and is
arbitrary otherwise. The usual embeddings  $p_\bX:V_\bX\to V_\bX\times V_\bY$ and $p_\bY:
V_{\bY}\to V_\bX\times V_\bY$ are easily seen to be morphsims in $\Af$.   

Let  $f:\bX\to \bZ$, $g:\bY\to \bZ$ be any morphisms in $\Af$ and consider the map
$V_\bX\times V_\bY\to V_\bZ$ given as
$f\oplus g(u,v)=f(u)+g(v)$. We need to show that it preserves the affine subspaces. So let 
$x\in A_\bX$, $y\in  A_\bY$, then since $f(x),g(y)\in A_\bZ$, we have for any $s\in \mathbb R$,
\[
f\oplus g(sx,(1-s)y)=sf(x)+(1-s)g(y)\in A_\bZ.
\]
We also have
\[
L_{X\oplus Y}= (L_X\times L_Y)\vee \mathbb R\{(a_X,-a_Y)\},\qquad S_{X\oplus Y}=S_X\times
S_Y
\]
for some $a_X\in A_X$, $a_Y\in A_Y$.

Similarly as in the case of products, it is verified that $X\oplus \emptyset=X$ and
$X\oplus 0=0$. (All the statements for coproducts can be obtained from duality defined
below).

\medskip

One can also discuss equalizers and coequalizers, here we only note that these may be
trivial even for proper objects. We will  consider pullbacks and pushouts for some special
morphisms that will be needed below.
(We may
also add
two special objects: the initial object $\emptyset:=(\{0\}, \emptyset)$ and the terminal
object $0:=(\{0\},\{0\})$, here the affine subspaces are obviously not proper.)

\subsubsection{Pullbacks and pushouts}

%\subsubsection{Bimorphism ordering and lattices of objects}
%
%Let $\Fe=\{X_\alpha\}_{\alpha\in \mathcal A}$ be a family of objects in $\Af$ such that there
%are objects $X_{in}$, $X_{out}$ and bimorphisms
%\[
%X_{in}\xrightarrow{u_\alpha} X_\alpha \xrightarrow{v_\alpha} X_{out},
%\]
%$V_{X_{in}}=V_{X_{out}}$ and $v_\alpha\circ u_\alpha=id$ for $\alpha\in \mathcal A$.
%Moreover, there are some elements $\tilde x_{in}\in \tilde A_{X_{in}}$, $x_{out}\in
%A_{X_{out}}$ and $x_\alpha\in A_{X_\alpha}$, $\tilde x_\alpha\in \tilde A_{X_\alpha}$ such
%that $u_\alpha^*(\tilde x_\alpha)=\tilde x_{in}$ and $v_\alpha(x_\alpha)=x_{out}$ for all
%$\alpha\in \mathcal A$. We have:
%
%\begin{enumerate}
%\item Let $X_\alpha \le X_\beta$ if there is a bimorphism $X_\alpha\xrightarrow{f}
%X_\beta$ such that $v_\beta\circ f=v_\alpha$ and $f\circ u_\alpha=u_\beta$. Then
%$\le$ is up to isomorphisms a partial order in $\Fe$. Indeed, $\le$ is obviously a preorder. Assume
%$X_\alpha\le X_\beta$ with the bimorphism $f$ and   $X_\beta\le X_\alpha$ with the
%bimorphism $g$. Then 
%\[
%f\circ g=f\circ u_\alpha\circ v_\alpha\circ g=u_\beta\circ v_\beta=id,
%\]
%so that $X_\alpha$ and $X_\beta$ are isomorphic. 
%
%
%
%\end{enumerate}
%
%
%
%




%Let us turn to equalizers. So let $f,g:\bX\to \bY$ and let 
%\[
%V_E=\{v\in V_\bX,\ f(v)=g(v)\}. 
%\]
%Let $h: \bZ\to \bX$ equalize $f,g$, then $h(V_\bZ)\subseteq V_E$ and $h(A_\bZ)\subseteq
%A_\bX\cap V_E$, so that $A_\bX\cap V_E$ must be nonempty. In this case, 
%\[
%\bE=(V_E, A_E:=V_E\cap A_\bX, a_E,\tilde a_E:=\tilde a_X)
%\]
%with the inclusion map $V_E\hookrightarrow V_\bX$ is an
%equalizer of $f,g$ for any choice of $a_E\in A_E$ (note that choosing another $a_E$ gives
%us an isomorphic object in $\Af$). If the
%intersection $V_E\cap A_\bX$ is empty, then the only equalizing arrow 
%for $f$ and $g$ is $\emptyset\to \bX$, which is
%then the equalizer.
%
%For the coequalizer, let $V_Q$ be the quotient space $V_Q:=V_\bY|_{Im(f-g)}$ and let
%$q:V_\bY\to V_Q$
%be the quotient map. If  some $h: \bY\to \bZ$ coequalizes $f$ and $g$, then $h$ maps
%$Im(f-g)$ to 0, so that $Im(f-g)\cap A_\bY=\emptyset$, unless $\bZ$ is the terminal
%object. It is easily checked that if $Im(f-g)\cap A_\bY=\emptyset$, then
%\[
%Q=(V_Q,A_Q:=q(A_\bY),a_Q:=q(a_Y),\tilde a_Q )
%\]
%together with the quotient map  $q$ is the
%coequalizer of $f$ and $g$ for any choice of $\tilde a_Q\in \tilde A_Q$.
%If the intersection is nonempty,
%then the unique coeqalizing arrow is $\bY\to 0$, which is then the coequalizer.
%
%Let us mention pullbacks and pushouts. Since pullbacks can be obtained from products and
%equalizers, we see that we have a similar situation: if a pullback is ''well defined'',
%then it coincides with the pullback in $\FV$, otherwise it is trivial. More precisely, if 
%$f:\bX\to \bZ$ and $g:\bY\to \bZ$, then we put 
%\[
%V_P:=\{(x,y)\in V_\bX\times V_\bY, f(x)=g(y)\}.
%\]
%If $V_P\cap A_\bX\times A_\bY\ne \emptyset$, that is, there are some $x\in A_\bX$ and $y\in
%A_\bY$ such that $f(x)=g(y)$, then 
%\[
%(V_P,A_P:=(A_\bX\times A_\bY)\cap V_P, a_P, \frac 12(\tilde a_X,\tilde a_Y))
%\]
%with the two projections
%is a pullback of $f$ and $g$ for any choice of $a_P\in A_P$, otherwise the pullback is
%just the initial object $\emptyset$.
%
%Similarly, let $f:\bZ\to \bX$, $g:\bZ\to \bY$, then let $V_Q$ be the quotient of
%$V_\bX\times V_\bY$ by the subspace
%\[
%\{(f(z),-g(z)),\ x\in V_\bZ\}.
%\]
%If this subspace does not contain any element of $A_\bX\oplus A_\bY$, that is, there is no
%$z\in V_\bZ$ such that for some $t\in \mathbb R$,
%\[
%f(tz)\in A_\bX,\qquad g((t-1)z)\in A_\bY,
%\]
%then 
%\[
%Q=(V_Q, A_Q:=q(A_\bX\oplus A_\bY), \frac12 q(a_X,a_Y), \tilde a_Q)
%\]
%with maps $x\mapsto q(x,0)$ and $y\mapsto q(0,y)$ is the
%pushout of $f$ and $g$. Otherwise the pushout is just $0$.
%
\subsubsection{Monoidal structure}

Let $X$, $Y$ be objects in $\Af$. Let us define
\[
A_{X\otimes Y}:=\{x\otimes y, x\in A_X, y\in A_Y\}^{\approx}.
\]
In other words, $A_{X\otimes Y}$ is the smallest affine subspace in $V_X\otimes V_Y$ containing
$A_X\otimes A_Y$. 


\subsubsection{Duality}

We define $X^*:=(V_X^*,\tilde A_X)$. Note that we have
\[
L_{X^*}=S_X^\perp,\qquad S_{X^*}=L_X^\perp,\qquad d_{X^*}=D_X-d_X-1.
\]
It is easily seen  that $(-)^*$ defines a full and faithful functor $\Af^{op}\to \Af$,
moreover, $X^{**}=X$ (we will use  the canonical identification of  any $V$ in $\FV$ with its second dual). 



\subsubsection{The dual tensor product}

Let us define the dual tensor product by $\odot$, that is
\[
X\odot Y=(X^*\otimes Y^*)^*.
\]
We then have
\begin{align*}
L_{X\odot Y}&=S^\perp_{X^*\otimes Y^*}=(S_{X^*}\otimes S_{Y^*})^\perp=(L_X^\perp\otimes
L_Y^\perp)^\perp\\
S_{X\odot Y}&= L_{X^*\otimes Y^*}^\perp=(\tilde a_X\otimes
S_Y^\perp)^\perp\wedge(S_X^\perp\otimes \tilde a_Y)^\perp\wedge (S_X^\perp\otimes
S_Y^\perp)^\perp
\end{align*}
In particular,
\[
d_{X\odot Y}=D_Xd_Y+d_XD_Y-d_Xd_Y.
\]
\begin{lemma}\label{lemma:tensors} Let $X$, $Y$ be nontrivial. Then $X\otimes Y=X\odot Y$
exactly in one of the following situations:
\begin{enumerate}
\item $X\simeq I$ or $Y\simeq I$,
\item $d_X=d_Y=0$,
\item $D_X=d_X+1$ and $D_Y=d_Y+1$ (Objects with this property will be called
first order).
\end{enumerate}

\end{lemma}

\begin{proof} It is easy to see that (when identifying $X=X^{**}$), we have $A_X\otimes
A_Y\subseteq \tilde A_{X^*\otimes  Y^*}$, hence $A_{X\otimes Y}\subseteq A_{X\odot Y}$. We see from the above computatons that
\[
d_{X\odot Y}-d_{X\otimes Y}=d_X(D_Y-1)+(D_X-1)d_Y-2d_Xd_Y\ge 0,
\]
with equality if and only if the conditions of the lemma hold.

\end{proof}


\subsubsection{The no signaling product} 

\begin{lemma}\label{lemma:otimes_odot}
The space $A_{X\otimes Y}$ is precisely the affine subspace of elements $w\in A_{X\odot Y}$,
such that $\<w,\cdot \otimes \tilde a_Y\>$ and $\<w,\tilde a_X\otimes \cdot\>$ do not
depend on the choice of $\tilde a_Y\in \tilde A_Y$ and $\tilde a_X\in \tilde A_X$.
\end{lemma}

\begin{proof} Any element $w\in A_{X\otimes Y}$ has the form $w=\sum_i\alpha_i x_i\otimes
y_i$, for $x_i\in A_X$, $y_i\in A_Y$ and $\sum_i\alpha_i=1$. It follows that for any
$\tilde a_X\in \tilde A_X$ and $\tilde a_Y\in \tilde A_Y$,
\[
\<w,\cdot\otimes \tilde a_Y\>=\sum_i\alpha_ix_i,\qquad \<w,\tilde a_X\otimes
\cdot\>=\sum_i\alpha_iy_i.
\]
Conversely, assume that $w\in A_{X\odot Y}$ has this property, then for any $\tilde x\in
L_{X^*}$ and
$\tilde y\in L_{Y^*}$, we have
\[
\<w,\cdot\otimes \tilde y\>=0,\qquad \<w,\tilde x\otimes \cdot\>=0.
\]
It follows that
\begin{align*}
w&\in (V_X^*\otimes L_{Y^*})^\perp\cap (L_{X^*}\otimes V_Y^*)^\perp=
(V_X\otimes S_Y)\cap (S_X\otimes V_Y)=S_X\otimes S_Y
\end{align*}
Since $w\in A_{X\odot Y}$, we have $\<w,\tilde a_X\otimes \tilde a_Y\>=1$ for any choice
of $\tilde a_X\in \tilde A_X$,  $\tilde a_Y\in \tilde A_Y$. Since $\tilde a_X\otimes
\tilde a_Y\in \tilde A_{X\otimes Y}$ and $S_{X\otimes Y}=S_X\otimes S_Y$, this implies
$w\in A_{X\otimes Y}$.

\end{proof}


We will now define one-sided variants of this property. Namely, let 
\begin{align*}
A_{X\prec Y}&:=\{w\in A_{X\odot Y},\ \<w,\cdot \otimes \tilde a_Y\>\text{ does not depend on
} \tilde a_Y\in \tilde A_Y\}\\
A_{X\succ Y}&:=\{w\in A_{X\odot Y},\ \<w,\tilde a_X \otimes \cdot\>\text{ does not depend on
} \tilde a_X\in \tilde A_X\}.
\end{align*}
We then put $X\prec Y=(V_X\otimes V_Y, A_{X\prec Y})$ and $X\succ Y=(V_X\otimes V_Y,
A_{X\succ Y})$.

\begin{lemma}\label{lemma:prec} For any choice of $a_Y\in A_Y$, we have
\[
L_{X\prec Y}=V_X\otimes L_Y+L_X\otimes a_Y,\qquad S_{X\prec Y} =V_X\otimes L_Y+S_X\otimes
a_Y.
\]
Similarly, for any $a_X\in A_X$, we have
\[
L_{X\succ Y}=L_X\otimes V_Y+a_X\otimes L_Y,\qquad S_{X\succ Y} =L_X\otimes V_Y+a_X\otimes
S_Y.
\]
\end{lemma}

\begin{proof} By the definition, we have
\[
L_{X\prec Y}= L_{X\odot Y}\cap (V_X^*\otimes L_{Y^*})^\perp=(S_{X^*}\otimes
S_{Y^*})^\perp\cap (V_X\otimes S_Y)=V_X\otimes L_Y+L_X\otimes a_Y,
\]
for any element $a_Y\in A_Y$.
The proof for $\succ$ is similar.

\end{proof}




For the rest of this section, we fix some  $a_X\in A_X$ and $\tilde a_X\in \tilde A_X$. We will use the notation
$X_{\min}:=(V_X,\{a_X\})$ and 
$X_{\max}=(V_X, \{\tilde a_X\}^\sim)$. 

%We then have the diagram
%\[
%\xymatrix{
% & & X\prec Y \ar[rd] \\
%X_{\min}\otimes Y_{\min} \ar[r] &X\otimes Y \ar[ru] \ar[rd] &  & X\odot Y
%\ar[r] & X_{\max}\otimes Y_{\max}\\
% &  & X\succ Y \ar[ru]
%}
%\]
%where the arrows are given by identity maps.
%
We also introduce a decomposition of $V_X$ into an independent family of subspaces
$L_X^0,L^1_X,L^2_X$ as
$L_X^0:=\mathbb Ra_X$, $L_X^1:=L_X$ and $L_X^2$ is any complement of $L_X$ in the subspace
$\{\tilde a_X\}^\perp$. We see that the $L$ or $S$ spaces of any of the objects discussed
in this paragraph is a union of some of the subspaces $L_X^i\otimes L_Y^j$, $i,j=0,1,2$. 
We may therefore represent the subspaces in question by $3\times 3$ matrices such that 
the $i,j$-th element is 1 if the subspace contains $L_X^i\otimes L_Y^j$ and 0 otherwise.
For example, we have
\begin{equation}\label{eq:matrices}
L_{X\otimes Y}\equiv \begin{bmatrix} 0& 1&0\\ 1 &1 &0\\ 0 & 0&0\end{bmatrix}, \ 
L_{X\odot Y}\equiv \begin{bmatrix} 0& 1&0\\ 1 &1 &1\\ 0 & 1&0\end{bmatrix},\ 
L_{X\prec Y}\equiv \begin{bmatrix} 0& 1&0\\ 1 &1 &0\\ 0 & 1 &0\end{bmatrix}, \ 
L_{X\succ Y}\equiv \begin{bmatrix} 0& 1&0\\ 1 &1 &1\\ 0 & 0&0\end{bmatrix}.
\end{equation}
The $S$-spaces can be obtained from these by putting the top left  element to 1. Notice
also that all these objects belong to the set of objects $Z=(V_X\otimes V_Y, A_Z)$ such
that
\[
X_{\min}\otimes Y_{\min}\hookrightarrow  Z \hookrightarrow X_{\max}\otimes
Y_{\max}(=X_{\max}\odot Y_{\max})
\]
and this set forms a lattice under inclusion ordering with $Z_0\wedge Z_1=Z_0\sqcap Z_1$,
$Z_0\vee Z_1=Z_0\sqcup Z_1$, where $\sqcap$ and $\sqcup$ are the pulback and pushout 
of the inclusions $X_{\min}\otimes Y_{\min}\hookrightarrow Z_i \hookrightarrow
X_{\max}\otimes Y_{\max}$. Furthermore, since $\{L_X^i\otimes L_Y^j\}$ is an independent
decomposition of $V_X\otimes V_Y$, all the objects  in \eqref{eq:matrices} are contained in a
distributive sublattice of objects such that $A_Z=a_X\otimes a_Y+L$, where $L$ is a subspace
represented by a  matrix $M_Z$ with the top left element equal to 0.
For such elements $Z_1$ and $Z_2$, the representing matrices  $M_{Z_1\sqcap Z_2}$ resp.
$M_{Z_1\sqcup Z_2}$ are given by
poinwise minimum resp. maximum of $M_{Z_1}$ and $M_{Z_2}$.


Some further useful elements of this sublattice are represented as
\[
L_{X_{\max}\otimes Y}\equiv\begin{bmatrix}0 & 1 & 0\\ 1 & 1& 0\\ 1& 1&0  \end{bmatrix},\ 
L_{X\otimes Y_{\max}}\equiv\begin{bmatrix}0 & 1 & 1\\ 1 & 1& 1\\ 0& 0&0  \end{bmatrix},\ 
L_{X_{\min}\odot Y}\equiv\begin{bmatrix}0 & 1 & 0\\ 0 & 1& 0\\ 0& 1&0  \end{bmatrix},\ 
L_{X\odot Y_{\min }}\equiv\begin{bmatrix}0 & 0 & 0\\ 1 & 1& 1\\ 0& 0&0  \end{bmatrix}. 
\]
From these consideration, the following is immediate.

\begin{lemma}\label{lemma:lattice} We have
\begin{align*}
X\prec Y &= (X\otimes Y) \sqcup (X_{\min}\odot Y)=(X\odot Y)\sqcap (X_{\max}\otimes Y)\\
X\succ Y &= (X\otimes Y) \sqcup (X\odot Y_{\min})=(X\odot Y)\sqcap (X\otimes Y_{\max})\\
X\otimes Y & = (X\prec Y)\sqcap (X\succ Y)\\
X\odot Y & = (X\prec Y)\sqcup (X\succ Y).
\end{align*}


\end{lemma}









We have 
the inclusions 
\[
X_a\to X\to X^{\tilde a}.
\]
We also fix $b\in A_Y$, $\tilde b\in \tilde A_Y$. By inclusions, we have the following diagrams
\[
X_a\otimes Y_b\to X\otimes Y,\qquad X_a\otimes Y_b\to  X_a\odot Y
\]
and
\[
X\odot Y\to X^{\tilde a}\odot Y^{\tilde b}=X^{\tilde
a}\otimes Y^{\tilde b},\qquad X\otimes Y^{\tilde b}\to X^{\tilde a}\otimes Y^{\tilde b}.
\]


\begin{lemma}\label{lemma:minmax}
$X\prec Y=X\otimes Y\sqcup X\odot Y_b=X\odot Y \sqcap X\otimes Y^{\tilde b}$.
\end{lemma}


We see that  the identity map $id_{V_X\otimes V_Y}$ defines bimorphisms
\[
X\otimes Y \to X\prec Y\to X\odot Y,\qquad X\otimes Y\to X\succ Y\to X\odot Y.
\]

\begin{lemma}\label{lemma:precsucc_pushpul} The  pushout and pullback of the above
diagram are
\[
X\otimes Y=(X\prec Y)\sqcap (X\succ Y),\qquad X\odot Y= (X\prec Y)\sqcup (X\succ Y).
\]

\end{lemma}

\begin{proof}  We have by Lemma \ref{lemma:otimes_odot} that 
\[
A_{X\otimes Y}=A_{X\prec Y}\cap A_{X\succ Y}=A_{(X\prec Y)\sqcap (X\succ Y)},
\]
we clearly have the last equality since the intersection $A_{X\prec Y}\cap A_{X\succ Y}$
is nonempty. For the second part,   


\end{proof}





To each object $X=(V_X,A_X,a_X,\tilde a_X)$ we may define two object
\[
X_{\min}:=(V_X,\{a_X\},a_X,\tilde a_X),\qquad X_{\max}:=(V_X,\{\tilde a_X\}^\sim,a_X,\tilde a_X). 
\]
It is easily seen that $X_{\min}=(X^*_{\max})^*$ and $X_{\max}=(X^*_{\min})^*$, moreover,
$X_{\max}$ and $(X_{\min})^*$ are first order objects. We have the inclusions
\[
X_{\min}\xrightarrow{id} X\xrightarrow{id} X_{\max}.
\]
We also have the inclusions
\[
X\otimes Y\to X\odot Y \to X_{\max}\odot Y_{\max}=X_{\max}\otimes Y_{\max}
\]
and
\[
X\otimes Y \to X_{\max}\otimes Y\to X_{\max}\otimes Y_{\max}, \quad X\otimes Y \to X\otimes Y_{\max}\to X_{\max}\otimes Y_{\max}.
\]
We can therefore define pullbacks and pushouts,  which then becomes
\[
(X_{\max}\otimes Y)\sqcap (X\otimes Y_{\max})=X\otimes Y,\qquad (X_{\max}\otimes Y)\sqcup
(X\otimes Y_{\max})=X_{\max}\otimes Y_{\max}.
\]
Hence we may decompose $X\odot Y$ into two parts
\[
X\prec Y:= (X\odot Y)\sqcap (X_{\max}\otimes Y),\qquad X\succ Y:=(X\odot Y) \sqcap
(X\otimes  Y_{\max}).
\]



Note that these forms do not depend on the choice of the elements $a_X,a_Y$...!

\begin{lemma}\label{lemma:decomp} We have
\[
X\otimes Y=(X\prec Y) \sqcap (X\succ Y),\qquad X\odot Y= (X\prec Y)\sqcup (X\succ Y).
\]

\end{lemma}

\begin{proof} We have 

\begin{align*}
(X\prec Y) \sqcap (X\succ Y)&=((X\odot Y)\sqcap (X_{\max}\otimes Y))\sqcap ((X\odot
Y)\sqcap (X\otimes Y_{\max}))\\
&= (X\odot Y) \sqcap((X_{\max}\otimes Y)\sqcap (X\otimes Y_{\max}))=(X\odot Y)\sqcap
(X\otimes Y)=X\otimes Y.
\end{align*}
The second equality follows easily from Lemma \ref{lemma:prec}
\end{proof}

We next show that $-\prec -$ and $-\succ -$ define a functor $\Af\times \Af\to \Af$. Let
$X_1\xrightarrow{f} Y_1$ and $X_2\xrightarrow{g} Y_2$, we will show that 
$X_1\prec Y_1\xrightarrow{f\otimes g} X_2\prec Y_2$. For this, we need to prove that 
$(f\otimes g)(A_{X_1\prec X_2})\subseteq A_{X_2\prec Y_2}$ and $(f\otimes g)(A_{X_1\succ
X_2})\subseteq A_{X_2\succ Y_2}$. This is clear from Lemma \ref{lemma:prec}. 



\begin{lemma}\label{lemma:precmonoidal} $(\Af,\prec,I)$ is a monoidal category.  

\end{lemma}

\begin{proof} It is easily checked from Lemma \ref{lemma:prec} that
$\alpha_{X,Y,X}(L_{(X\prec Y)\prec Z})=L_{X\prec(Y\prec Z)}$ and clearly also
$\alpha_{X,Y,Z}(a_X\otimes a_Y\otimes a_Z)=a_X\otimes a_Y\otimes a_Z$, so that $\alpha$ is
the associator. Since $I\otimes X=I\odot X$ and $X\odot I=X\otimes I$, we have 
$I\prec X=I\otimes X$ and $X\prec I=X\otimes I$, so $\lambda$ and $\rho$ are the
unitors. But note that $\sigma_{X,Y}(A_{X\prec Y})=A_{Y\succ X}$, so this structure is
not symmetric. 

\end{proof}

We have $(X\prec Y)^*=X^*\prec Y^*$. Indeed, by duality,
\begin{align*}
(X\prec Y)^*&=((X\odot Y)\sqcap (X_{\max}\odot Y))^*=(X\odot Y)^*\sqcup (X_{\max}\otimes
Y)^*\\
&= (X^*\otimes Y^*)\sqcup (X_{\max}^*\odot Y^*)
\end{align*}




\subsubsection{Internal hom}

The internal hom has the form
\begin{equation}\label{eq:ihom}
[X,Y]=(X\otimes Y^*)^*=X^*\odot Y.
\end{equation}
We then have 
\begin{align*}
L_{[X,Y]}&=(S_X\otimes L_Y^\perp)^\perp= (V_X^*\otimes L_Y)\vee (L_{X^*}\otimes V_Y), \\
S_{[X,Y]}&=(\tilde a_X\otimes
S_Y^\perp)^\perp\wedge(L_X\otimes \tilde a_Y)^\perp\wedge (L_X\otimes
S_Y^\perp)^\perp=(V_X^*\otimes L_Y)\vee (L_{X^*}\otimes V_Y)\vee (\tilde a_X\otimes a_Y).
\end{align*}
and
\[
d_{[X,Y]}=D_XD_Y-(d_X+1)(D_Y-d_Y).
\]


As we have seen in $\FV$, the space $V_{[X,Y]}=V_X^*\otimes V_Y$ is identified with the
space of all linear maps $V_X\to V_Y$, by \eqref{eq:fvhoms}. We will show that $A_{[X,Y]}$ corresponds to the
affine subspace of maps mapping $A_X$ into $A_Y$, that is, morphisms in $\Af$. Indeed, we see from \eqref{eq:fvhoms}
that $f$ is in $\Af$ if and only if 
\[
\<f(x),y^*\>=\<w,x\otimes y^*\>=1, \qquad x\in A_X,\ y^*\in \tilde A_Y,
\]
which is equivalent to $w\in (A_X\otimes \tilde A_Y)^\sim=\tilde A_{X\otimes Y^*}$. 

\subsubsection{The no signaling product}

For two objects $X$, $Y$ we define 
\[
X\prec Y :=(V_X\otimes V_Y, A_{X\prec Y},a_X\otimes a_Y,\tilde a_X\otimes \tilde a_Y),
\]
where $A_{X\prec Y}$ is determined by
\begin{align*}
S_{X\prec Y}=V_X\otimes S_Y\cap S_{X\odot Y}=(V_X\otimes S_Y)\cap (L_{X\odot Y}\vee
\{a_X\otimes a_Y\})=(V_X\otimes S_Y)\cap((V_X\otimes L_Y)\vee (L_X\otimes V_Y)\vee
\{a_X\otimes a_Y\}).
\end{align*}


\begin{lemma}\label{lemma:}


\end{lemma}

We may similarly define $X\succ Y$. Setting $f\prec g=f\otimes g$ for $X_1\xrightarrow{f}
X_2$, $Y_1\xrightarrow{g} Y_2$, we see that $(-\prec -)$ is functorial. Indeed, to show
that $X_1\prec Y_1\xrightarrow{f\otimes g} X_2\prec Y_2$, we need to
show that $f\otimes g(A_{X_1\prec Y_1})\subseteq A_{X_2\prec Y_2}$. Assume $w\in
A_{X_1\prec Y_1}$, that is, $w\in V_{X_1}\otimes S_{Y_1}$ and $\<w,\tilde a_{X_1}\otimes
\tilde a_{Y_1}\>=1$. 

\subsubsection{Dualizable (nuclear) objects}

An object in $\Af$ is nuclear if the natural map $X^*\otimes X\to [X,X]$ is an isomorphism
(santocanale). That is, the inclusion $X^*\otimes X\subseteq X^*\odot X$ that comes from the embedding 
\[
\tilde A_X\otimes A_X\subseteq (A_X\otimes \tilde A_X)^\sim
\]
becomes an equality. As we have seen in Lemma \ref{lemma:tensors}, for proper objects we
have $X^*\otimes X=X^*\odot X$ if and only if
\[
d_X+1=D_X=D_{X^*}=d_{X^*}+1=D_X-d_X.
\]
It follows that $d_X=0$ and $D_X=1$, so that $X\simeq I$. Hence the tensor unit is the
unique dualizable (or nuclear) object in $\Af$.


\subsubsection{No signaling}

We say that $X\xrightarrow{f} Y$ is no signaling if
\[
y^*\circ f=\tilde a_Y\circ f,\qquad \forall y\in Y^*=[Y,I],
\]
in other words
\[
y\circ f=0,\qquad \forall y^*\in L_{Y^*}=S_Y^\perp.
\]
Taking $w\in A_{[X,Y]}$ be the corresponding elements, this means that
\[
\<w,x\otimes y^*\>=0,\qquad \forall x\in V_X,\ y^*\in S_Y^\perp,
\]
in other words
\[
w\in (V_X\otimes S_Y^\perp)^\perp=V^*_X\otimes S_Y,
\]
so that
\[
w\in A_{[X,Y]}\cap (V^*_X\otimes S_Y).
\]
Since $a_{[X,Y]}=\tilde a_X\otimes a_Y\in V^*_X\otimes S_Y$, we have that
\[
a_{[X,Y]}-w\in L_{[X,Y]}\cap V^*_X\otimes S_Y=(S_X\otimes L_Y^\perp)^\perp\cap
V^*_X\otimes S_Y=(V_X^*\otimes L_Y)+ (L_{X^*}\otimes a_Y).
\]
We can also define no signaling in the oposite way, that is,
\[
f(x)=f(a_X),\qquad \forall x\in A_X.
\]
This is of course the same as 
\[
f(x)=0,\qquad \forall x\in L_X,
\]
or
\[
\<w,x\otimes y^*\>=0,\qquad \forall x\in L_X,\ y^*\in V_Y^*,
\]
that is,
\[
w\in (L_X\otimes V_Y^*)^\perp=L_X^\perp\otimes V_Y=S_{X^*}\otimes V_Y.
\]
It follows that
\[
\tilde a_X\otimes a_Y-w\in L_{[X,Y]}\cap S_{X^*}\otimes V_Y=L_{X^*}\otimes V_Y+\tilde
a_X\otimes L_Y.
\]

\subsection{Once more on the monoidal structures}

\subsubsection{Tensor product}

We have
\[
L_{X\otimes Y}=(a_X\otimes L_Y)+(L_X\otimes a_Y)+(L_X\otimes L_Y)=(S_X\otimes
L_Y)+(L_X\otimes a_Y)=(L_X\otimes S_Y)+(a_X\otimes L_Y)
\]
A closed symmetric monoidal structure. We have 
\[
L_{X_{\max} \otimes Y}=V_X\otimes L_Y+\{\tilde a_X\}^\perp\otimes a_Y,\qquad L_{X_{\min}\otimes Y}=a_X\otimes L_Y.
\]
\begin{lemma}\label{lemma:maxtensor}
We have
\[
X\otimes Y=(X_{\max}\otimes Y)\sqcap (X\otimes Y_{\max}). 
\]

\begin{proof} This is easy, since
\[
S_{X_{\max}\otimes Y}\cap S_{X\otimes Y_{\max}}=(V_X\otimes S_Y)\cap (S_X\otimes
V_Y)=S_X\otimes S_Y.
\]

\end{proof}

\end{lemma}

\subsubsection{Dual product}
By definition,  $X\odot Y=(X^*\otimes Y^*)^*$. We have
\[
L_{X\odot Y}=(L_X^\perp\otimes L_Y^\perp)^\perp=(V_X\otimes L_Y)\vee (L_X\otimes V_Y).
\]
We have
\[
L_{X_{\max}\odot Y}=(V_X\otimes L_Y)\vee(\{\tilde a_X\}^\perp\otimes V_Y),\qquad
L_{X_{\min}\odot Y}=V_X\otimes L_Y.
\]
\begin{lemma}\label{lemma:maxdual} We have
\begin{align*}
X_{\max}\otimes Y_{\max}&=(X_{\max}\odot Y)\sqcup (X\odot Y_{\max})\\
X\odot Y&=(X_{\min}\odot Y)\sqcup (X\odot Y_{\min})\\
X\otimes Y&= (X_{\min}\otimes Y)\sqcup (X\otimes Y_{\min})\sqcup (X_{\min}\odot Y \sqcap
X\odot Y_{\min}) 
\end{align*}


\end{lemma}

\begin{proof} The first is easy, the seconf follows from Lemma \ref{lemma:maxtensor} by
duality, the third is also easy.

\end{proof}

\subsection{The no signalling product}

Let us define $X\prec Y:= (X\odot Y)\sqcap (X_{\max}\otimes Y)$. We have
\[
L_{X\prec Y}=V_X\otimes L_Y+L_X\otimes a_Y=L_{X_{\min}\odot Y}+L_{Y\otimes Y_{\min}}.
\]
So that
\[
X\prec Y:= (X\odot Y)\sqcap (X_{\max}\otimes Y)=(X_{\min}\odot Y)+(X\otimes Y_{\min})
\]

\begin{lemma}\label{lemma:nosig}
We have
\begin{align*}
(X\otimes Y)\sqcup (X_{\min}\odot Y)&=(X\odot Y)\sqcap (X_{\max}\otimes Y)\\
=(X_{\min}\odot Y) + (X\otimes Y_{\min})&=(X_{\max}\otimes Y)\sqcap (X\odot Y_{\max}).
\end{align*}
Let us denote the above object by $X\prec Y$. Then $A_{X\prec Y}$ is the set of elements
in $V_X\otimes V_Y$ such that $\<w,\cdot \otimes y^*\>$ is a fixed element in $A_X$,
independently of $y^*\in \tilde A_Y$.
\end{lemma}

Blbe uvedenie, definicia!

\begin{proof} We see that $A_{X\prec Y}\subseteq A_{X\odot Y}$, moreover,
\[
A_{X\prec Y}=\{w\in A_{X\odot Y},\ \<w,id_X\otimes y^*\>=0,\ \forall y^*\in L_{Y^*}\}.
\]
In other words, since clearly $a_X\otimes a_Y\in A_{X\prec Y}$,
\begin{align*}
L_{X\prec Y}&=\{w-a_X\otimes a_Y,\ w\in A_{X\prec Y}\}=L_{X\odot Y}\cap (V^*_X\otimes
L_Y^*)^\perp=(L_X^\perp\otimes S_{Y^*})^\perp\cap(V_X^*\otimes L_{Y^*})^\perp\\
&=((L_X^\perp\otimes S_{Y^*})\vee (V_X^*\otimes L_{Y^*}))^\perp=((V_X^*\otimes
L_{Y^*})+(S_X^*\otimes \tilde a_Y))^\perp=S_{(X\prec Y)^*}^\perp
\end{align*}
But also
\begin{align*}
L_{X\odot Y}\cap (V^*_X\otimes
L_Y^*)^\perp&=((V_X\otimes L_Y)\vee L_X\otimes V_Y)\cap (V_X\otimes S_Y)\\
&=
((V_X\otimes L_Y)+(L_X\otimes a_Y)+(L_X\otimes S_Y'))\cap ((V_X\otimes L_Y)+(L_X\otimes
a_Y)+ (L_X'\otimes a_Y))\\
&=((V_X\otimes L_Y)+(L_X\otimes a_Y). 
\end{align*}

First note that we have 
\[
L_{X_{\min}\odot Y}=V_X\otimes L_Y,\qquad L_{X\otimes Y_{\min}}=L_X\otimes a_Y
\]
and therefore
\[
L_{X\otimes Y_{\min}}\cap L_{X_{\min}\odot Y}=\{0\}.
\]
Further,
\[
L_{X\otimes Y}= (S_X\otimes L_Y)+ (L_X\otimes a_Y)=(S_X\otimes L_Y)+L_{X\otimes Y_{\min}}
\]
and
\[
L_{X\odot Y}=(V_X\otimes L_Y)\vee (L_X\otimes V_Y),\qquad L_{X_{\max}\otimes Y}=(V_X\otimes
L_Y)+(\{\tilde a_X\}^\perp\otimes a_Y)
\]
We have
\[
S_{(X\otimes Y)\sqcup (X_{\min}\odot Y)}=S_{X\otimes Y}\vee S_{X_{\min}\odot Y}=
S_{X\otimes Y}\vee L_{X_{\min}\odot Y}
\]

\end{proof}

\subsection{The category $\Afh$} 


The category $\Afh$ will be constructed as a subcategory in $\Af$. 

\subsubsection{First order objects}

It is easily seen that the following are equivalent:
\begin{enumerate}
\item $D_X=d_X+1$;
\item $S_X=V_X$;
\item $L_X=\{\tilde a_X\}^\perp$;
\item $S_{X^*}=\mathbb R \tilde a_X$;
\item $L_{X^*}=\{0\}$.
\end{enumerate}
We say that an object $X$ is first order if any of these conditions is fulfilled. We have
seen that for proper objects, $X\otimes Y=X\odot Y$ if and only if both $X$ and $Y$ are
first order. We also have

\begin{lemma}\label{lemma:firstorder} $X$ is first order if and only if  $X\otimes
X=X\odot X$.

\end{lemma}
`
\begin{lemma}\label{lemma:1ordertensor} Let $X$, $Y$ be first order, then $X\otimes Y$ is
first order.

\end{lemma}

\begin{proof} We have
\[
S_{X\otimes Y}=S_X\otimes S_Y=V_X\otimes V_Y=V_{X\otimes Y}.
\]

\end{proof}


\subsubsection{Channels}
A channel is an object $[X,Y]$ where  $X$ and $Y$ are first order. As we have seen,
\[
X^*\otimes Y\subseteq X^*\odot Y=[X,Y].
\]
If $X$ is first order, $\tilde A_X=\{\tilde a_X\}$ and the elements of $A_{X^*\otimes
Y}=\tilde a_X\otimes A_Y$ are identified with channels of the form
\[
f(x)=\<\tilde a_X,x\>y,\qquad x\in V_X,
\]
for some $y\in A_Y$. Such maps will be called replacement channels.

\begin{lemma}\label{lemma:channels} Let $X$, $Y$ be first order and let  $w\in V_X^*\otimes V_Y$. Then $w
\in A_{[X,Y]}$ if and only if
\[
\circ_Y :w_{X^*Y}\otimes \tilde a_Y\mapsto \tilde a_X.
\]
\end{lemma}

\begin{proof} Let $f:V_X\to V_Y$ be the map corresponding to $w$, then 
\[
\circ_Y(w\otimes \tilde a_Y)=(V_X^*\otimes e_{V_Y})(w\otimes \tilde a_Y)=\tilde a_Y\circ
f,
\]
where $\tilde a_Y\in V_Y^*$ is seen as a map $V_y\to \mathbb R$. So $\tilde a_Y\circ f:
V_X\to \mathbb R$ is an element in $V_X^*$. We know that $w\in A_{[X,Y]}$ iff
$f(A_X)\subseteq A_Y$, which is equivalent to  $\tilde a_Y\circ f(x)=1$ for all $x\in A_X$, so
that $\tilde a_Y\circ f\in \tilde A_X=\{\tilde a_X\}$, since $X$ is first order.  
\end{proof}

\begin{lemma}\label{lemma:mapsdual} Let $Y$ be first order and $w\in V_X^*\otimes V_Y$.
Then $w\in A_{[X,Y]}$ if and only if
\[
\circ_Y(w_{X^*Y}\otimes \tilde a_Y)\in \tilde A_X.
\]
Moreover, 
\[
\tilde A_{[X,Y]}=A_X\otimes \{\tilde a_Y\}.
\]


\end{lemma}

\begin{proof} Since $Y$ is first order, we have $A_{Y^*}=\tilde A_Y=\{\tilde a_Y\}$ and by
\eqref{eq:ihom}
\[
\tilde A_{[X,Y]}=A_{X\otimes Y^*}=A_X\otimes \{\tilde a_Y\}.
\]
As in the above proof, let $f:V_X\to V_Y$ be the map corresponding to $w$. Then $\tilde
a_Y\circ f\in V_X^*$ and $w\in A_{[X,Y]}$ iff $f(A_X)\subseteq A_Y$. This means that
\[
\tilde a_Y\circ f(x)=1,\qquad \forall x\in A_X,
\]
which means that $\tilde a_Y\circ f\in \tilde A_X$.

\end{proof}

\subsubsection{$\Afh$}

The category $\Afh$ is the full subcategory in $\Af$ created from first order objects by
taking tensor products and duals. We will add more later. We will use the notation
$V_{XY^*}$ for $V_X\otimes V^*_Y$, etc. 

Any object $X$ in $\Afh$ is created from first order objects $X_1,\dots, X_k$, so that
$V_X=\tilde V_{X_1}\otimes\dots\otimes \tilde V_{X_k}$, where $\tilde V_{X_i}$ is either
$V_{X_i}$ or $V^*_{X_i}$, $i=1,\dots,k$. We will next show that any object is a set of
channels that contains all replacement channels. 



\begin{prop}\label{prop:afh} Let $X$ be an object in $\Afh$. Then there are  first order
objects $Y_I$ and $Y_O$ and inclusions $f$, $g$ such that
\begin{equation}\label{eq:inclusions}
Y_I^*\otimes Y_O \xrightarrow{f} X\xrightarrow{g} [Y_I,Y_O].
\end{equation}


\end{prop}

\begin{proof} Let $X$ be first order, then since $I$ is first order,
\[
I^*\otimes X=I\otimes X \xrightarrow{\lambda_X} X\xrightarrow{\lambda^{-1}_X} I\otimes
X=I\odot X=[I,X].
\]
Clearly, $f=\lambda_X$ and $g=\lambda^{-1}_X$ are inclusions. Now assume that $Z$
satisfies \eqref{eq:inclusions} and let $X=Z^*$. Taking duals and composing with
symmetries, we get
\[
Y_O^*\otimes Y_I\xrightarrow{\sigma_{V_{Y,O}^*,V_{Y_I}}} Y_I\otimes Y_0^*=[Y_I\otimes
Y_O]^*\xrightarrow{g^*} X\xrightarrow{f^*} (Y_I^*\otimes
Y_O)^*\xrightarrow{\sigma_{V_{Y_I},V_{X_O}^*}} (Y_O\otimes Y_I)^*=[Y_O,Y_I].
\]
Since the compositions of $f^*$ and $g^*$ with symmetries are inclusions, we see that $X$
satisfies \eqref{eq:inclusions}.

Next, let $X_1$ and $X_2$ satisfy \eqref{eq:inclusions}  with some first order objects $Y_I^i$, $Y_O^i$ and
inclusions $f^i,g^i$, $i=1,2$, and let $X=X_1\otimes X_2$. We then have, using the
appropriate symmetries
\[
Y_I^1Y_I^2\otimes (Y_O^1Y_O^2)^*\xrightarrow{\sigma_{Y_I^2,Y_O^1}} Y_I^1\otimes
(Y_O^1)^*\otimes Y_I^2\otimes (Y_O^1)^*\xrightarrow{f^1\otimes f^2} X
\xrightarrow{g^1\otimes g^2} [Y_I^1,Y_O^1]\otimes
[Y_I^2,Y_O^2]\xrightarrow{\sigma_{Y_O^1,Y_O^2}}[Y_I^1Y_I^2,I_O^1Y_O^2].
\]
Perhaps the last arrow needs some checking, so lt us do it properly. We need to show that
for $w\in A_{[Y_I^1,Y_O^1]\otimes
[Y_I^2,Y_O^2]}$, we have $\sigma_{Y_O^1,Y_O^2}(w)\in A_{[Y_I^1Y_I^2,I_O^1Y_O^2]}$, but
this is clear using Lemma \ref{lemma:channels}.

\end{proof}

The pair $(Y_I,Y_O)$ for an object $X$ will be called the $\type$ of $X$. For objects of
the same $\type$ we may take
pullbacks and pushouts of the  corresponding inclusions.




Pullbacks are intersections, pushouts the affine mixture.

Channels into (from) products and coproducts

We define $\Afh$ as the full subcategory of $\Af$ containing all first order objects and
closed under (finite products,) duals and  tensor products . 



\end{document}

